<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="1. Goè¯­è¨€é”™è¯¯å¤„ç†å“²å­¦\rGoè¯­è¨€é‡‡ç”¨äº†æ˜¾å¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸å…¶ä»–è¯­è¨€çš„å¼‚å¸¸å¤„ç†ä¸åŒã€‚Goè®¤ä¸ºé”™è¯¯æ˜¯ç¨‹åºæ­£å¸¸æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥è¢«æ˜¾å¼åœ°æ£€æŸ¥å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯é€šè¿‡å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†ã€‚è¿™ç§è®¾è®¡ç†å¿µè®©é”™è¯¯å¤„ç†æ›´åŠ é€æ˜å’Œå¯æ§ã€‚\n"><title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åäºŒç¯‡ é”™è¯¯å¤„ç†(error)ã€‘</title><link rel=canonical href=https://zg-dd.github.io/stu/golang-stu-12/><link rel=stylesheet href=/scss/style.min.ff560f1cad7a040e336f2dd6880b9ee1ad344d6e3d8f5411e5a1aaa8b23bbdd0.css><meta property='og:title' content="Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åäºŒç¯‡ é”™è¯¯å¤„ç†(error)ã€‘"><meta property='og:description' content="1. Goè¯­è¨€é”™è¯¯å¤„ç†å“²å­¦\rGoè¯­è¨€é‡‡ç”¨äº†æ˜¾å¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸å…¶ä»–è¯­è¨€çš„å¼‚å¸¸å¤„ç†ä¸åŒã€‚Goè®¤ä¸ºé”™è¯¯æ˜¯ç¨‹åºæ­£å¸¸æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥è¢«æ˜¾å¼åœ°æ£€æŸ¥å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯é€šè¿‡å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†ã€‚è¿™ç§è®¾è®¡ç†å¿µè®©é”™è¯¯å¤„ç†æ›´åŠ é€æ˜å’Œå¯æ§ã€‚\n"><meta property='og:url' content='https://zg-dd.github.io/stu/golang-stu-12/'><meta property='og:site_name' content='å°å··çš„éšç¬”'><meta property='og:type' content='article'><meta property='article:section' content='Stu'><meta property='article:tag' content='Golangè¯­æ³•'><meta property='article:published_time' content='2026-02-04T20:15:16+08:00'><meta property='article:modified_time' content='2026-02-04T20:15:16+08:00'><meta name=twitter:title content="Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åäºŒç¯‡ é”™è¯¯å¤„ç†(error)ã€‘"><meta name=twitter:description content="1. Goè¯­è¨€é”™è¯¯å¤„ç†å“²å­¦\rGoè¯­è¨€é‡‡ç”¨äº†æ˜¾å¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸å…¶ä»–è¯­è¨€çš„å¼‚å¸¸å¤„ç†ä¸åŒã€‚Goè®¤ä¸ºé”™è¯¯æ˜¯ç¨‹åºæ­£å¸¸æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥è¢«æ˜¾å¼åœ°æ£€æŸ¥å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯é€šè¿‡å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†ã€‚è¿™ç§è®¾è®¡ç†å¿µè®©é”™è¯¯å¤„ç†æ›´åŠ é€æ˜å’Œå¯æ§ã€‚\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_a0cc1cf57968b27d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸŒ±</span></figure><div class=site-meta><h1 class=site-name><a href=/>å°å··çš„éšç¬”</a></h1><h2 class=site-description>è®°å½•ï¼Œä¸æ˜¯ä¸ºäº†è¯æ˜è‡ªå·±ï¼›è€Œæ˜¯æŠŠâ€œè§£å†³é—®é¢˜ â†’ æ€è€ƒ â†’ æ²‰æ·€â€å½¢æˆä¹ æƒ¯ã€‚</h2></div></header><ol class=menu id=main-menu><li class=current><a href=/stu/><span>å­¦ä¹ ç¬”è®°</span></a></li><li><a href=/blog/><span>éšç¬”æ€è€ƒ</span></a></li><li><a href=/life/><span>ç”Ÿæ´»è®°å½•</span></a></li><li><a href=/categories/><span>åˆ†ç±»</span></a></li><li><a href=/tags/><span>æ ‡ç­¾</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://zg-dd.github.io/ selected>ç®€ä½“ä¸­æ–‡</option><option value=https://zg-dd.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#11-goé”™è¯¯å¤„ç†çš„ç‰¹ç‚¹>1.1 Goé”™è¯¯å¤„ç†çš„ç‰¹ç‚¹</a></li><li><a href=#12-ä¸ºä»€ä¹ˆgoé€‰æ‹©æ˜¾å¼é”™è¯¯å¤„ç†>1.2 ä¸ºä»€ä¹ˆGoé€‰æ‹©æ˜¾å¼é”™è¯¯å¤„ç†</a></li></ul><ul><li><a href=#21-erroræ¥å£å®šä¹‰>2.1 erroræ¥å£å®šä¹‰</a></li><li><a href=#22-errorsåŒ…çš„åŸºæœ¬ä½¿ç”¨>2.2 errorsåŒ…çš„åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#23-è‡ªå®šä¹‰é”™è¯¯ç±»å‹>2.3 è‡ªå®šä¹‰é”™è¯¯ç±»å‹</a></li></ul><ul><li><a href=#31-åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼>3.1 åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼</a></li><li><a href=#32-é”™è¯¯ç±»å‹æ–­è¨€å¤„ç†>3.2 é”™è¯¯ç±»å‹æ–­è¨€å¤„ç†</a></li></ul><ul><li><a href=#41-errorsåŒ…çš„æ–°åŠŸèƒ½go-113>4.1 errorsåŒ…çš„æ–°åŠŸèƒ½ï¼ˆGo 1.13+ï¼‰</a></li><li><a href=#42-å¤šé”™è¯¯å¤„ç†>4.2 å¤šé”™è¯¯å¤„ç†</a></li></ul><ul><li><a href=#51-webæœåŠ¡é”™è¯¯å¤„ç†>5.1 WebæœåŠ¡é”™è¯¯å¤„ç†</a></li><li><a href=#52-æ•°æ®åº“æ“ä½œé”™è¯¯å¤„ç†>5.2 æ•°æ®åº“æ“ä½œé”™è¯¯å¤„ç†</a></li></ul><ul><li><a href=#61-é”™è¯¯å¤„ç†åŸåˆ™>6.1 é”™è¯¯å¤„ç†åŸåˆ™</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/golang/>Golang</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/stu/golang-stu-12/>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åäºŒç¯‡ é”™è¯¯å¤„ç†(error)ã€‘</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-04T20:15:16+08:00>Feb 04, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 21 åˆ†é’Ÿ</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://zg-dd.github.io/en/stu/golang-stu-12/ class=link>English</a></div></footer></div></header><section class=article-content><h1 id=1-goè¯­è¨€é”™è¯¯å¤„ç†å“²å­¦>1. Goè¯­è¨€é”™è¯¯å¤„ç†å“²å­¦</h1><blockquote><p>Goè¯­è¨€é‡‡ç”¨äº†æ˜¾å¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸å…¶ä»–è¯­è¨€çš„å¼‚å¸¸å¤„ç†ä¸åŒã€‚Goè®¤ä¸ºé”™è¯¯æ˜¯ç¨‹åºæ­£å¸¸æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œåº”è¯¥è¢«æ˜¾å¼åœ°æ£€æŸ¥å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯é€šè¿‡å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†ã€‚è¿™ç§è®¾è®¡ç†å¿µè®©é”™è¯¯å¤„ç†æ›´åŠ é€æ˜å’Œå¯æ§ã€‚</p></blockquote><h2 id=11-goé”™è¯¯å¤„ç†çš„ç‰¹ç‚¹>1.1 Goé”™è¯¯å¤„ç†çš„ç‰¹ç‚¹</h2><p><strong>Goçš„é”™è¯¯å¤„ç†å“²å­¦</strong>ï¼š</p><ul><li>é”™è¯¯æ˜¯å€¼ï¼Œä¸æ˜¯å¼‚å¸¸</li><li>æ˜¾å¼æ£€æŸ¥æ¯”å›é¿æ›´å¥½</li><li>é”™è¯¯åº”è¯¥è¢«å¤„ç†ï¼Œè€Œä¸æ˜¯è¢«å¿½ç•¥</li><li>å¤±è´¥çš„è¯·æ±‚æ˜¯æ­£å¸¸çš„ï¼ŒæˆåŠŸçš„è¯·æ±‚æ‰æ˜¯ä¾‹å¤–</li></ul><p><strong>ä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Javaé£æ ¼çš„å¼‚å¸¸å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> = <span style=color:#a6e22e>riskyOperation</span>();
</span></span><span style=display:flex><span>} <span style=color:#a6e22e>catch</span> (<span style=color:#a6e22e>Exception</span> <span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¤„ç†å¼‚å¸¸</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Goé£æ ¼çš„é”™è¯¯å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>riskyOperation</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¤„ç†é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=12-ä¸ºä»€ä¹ˆgoé€‰æ‹©æ˜¾å¼é”™è¯¯å¤„ç†>1.2 ä¸ºä»€ä¹ˆGoé€‰æ‹©æ˜¾å¼é”™è¯¯å¤„ç†</h2><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li><strong>æ¸…æ™°å¯è§</strong>ï¼šé”™è¯¯å¤„ç†é€»è¾‘æ˜ç¡®ï¼Œä¸ä¼šéšè—åœ¨æ·±å¤„</li><li><strong>å¼ºåˆ¶å¤„ç†</strong>ï¼šç¼–è¯‘å™¨ä¼šæé†’ä½ å¤„ç†è¿”å›çš„é”™è¯¯</li><li><strong>æ€§èƒ½æ›´å¥½</strong>ï¼šé¿å…äº†å¼‚å¸¸å¤„ç†çš„æ€§èƒ½å¼€é”€</li><li><strong>æ›´å¯æ§</strong>ï¼šç¨‹åºå‘˜å®Œå…¨æ§åˆ¶é”™è¯¯å¤„ç†æµç¨‹</li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ol><li><strong>ä»£ç å†—é•¿</strong>ï¼šéœ€è¦å¤§é‡çš„if err != nilæ£€æŸ¥</li><li><strong>å®¹æ˜“å¿½ç•¥</strong>ï¼šæ–°æ‰‹å¯èƒ½ä¹ æƒ¯æ€§å¿½ç•¥é”™è¯¯æ£€æŸ¥</li></ol><h1 id=2-erroræ¥å£è¯¦è§£>2. erroræ¥å£è¯¦è§£</h1><h2 id=21-erroræ¥å£å®šä¹‰>2.1 erroræ¥å£å®šä¹‰</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// erroræ¥å£å®šä¹‰åœ¨builtinåŒ…ä¸­</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>error</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=22-errorsåŒ…çš„åŸºæœ¬ä½¿ç”¨>2.2 errorsåŒ…çš„åŸºæœ¬ä½¿ç”¨</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºç®€å•é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;é”™è¯¯1ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;é”™è¯¯1ç±»å‹ï¼š%T\n&#34;</span>, <span style=color:#a6e22e>err1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨fmt.Errorfåˆ›å»ºæ ¼å¼åŒ–é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;å¼ ä¸‰&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>age</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ· %s çš„å¹´é¾„ %d æ— æ•ˆ&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>age</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;é”™è¯¯2ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// é”™è¯¯çš„å­—ç¬¦ä¸²è¡¨ç¤º</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;é”™è¯¯1çš„å­—ç¬¦ä¸²ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>err1</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;é”™è¯¯2çš„å­—ç¬¦ä¸²ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>err2</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// nilé”™è¯¯è¡¨ç¤ºæ²¡æœ‰é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>noError</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;nilé”™è¯¯ï¼š%vï¼Œæ˜¯å¦ä¸ºnilï¼š%t\n&#34;</span>, <span style=color:#a6e22e>noError</span>, <span style=color:#a6e22e>noError</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>é”™è¯¯1ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯
</span></span><span style=display:flex><span>é”™è¯¯1ç±»å‹ï¼š*errors.errorString
</span></span><span style=display:flex><span>é”™è¯¯2ï¼šç”¨æˆ· å¼ ä¸‰ çš„å¹´é¾„ -5 æ— æ•ˆ
</span></span><span style=display:flex><span>é”™è¯¯1çš„å­—ç¬¦ä¸²ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯
</span></span><span style=display:flex><span>é”™è¯¯2çš„å­—ç¬¦ä¸²ï¼šç”¨æˆ· å¼ ä¸‰ çš„å¹´é¾„ -5 æ— æ•ˆ
</span></span><span style=display:flex><span>nilé”™è¯¯ï¼š&lt;nil&gt;ï¼Œæ˜¯å¦ä¸ºnilï¼štrue
</span></span></code></pre></div><h2 id=23-è‡ªå®šä¹‰é”™è¯¯ç±»å‹>2.3 è‡ªå®šä¹‰é”™è¯¯ç±»å‹</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰é”™è¯¯ç±»å‹1ï¼šç®€å•ç»“æ„ä½“</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ValidationError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Field</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Value</span>   <span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>ValidationError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;éªŒè¯é”™è¯¯ - å­—æ®µï¼š%sï¼Œå€¼ï¼š%vï¼ŒåŸå› ï¼š%s&#34;</span>, 
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Field</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰é”™è¯¯ç±»å‹2ï¼šå¸¦é”™è¯¯ç </span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>APIError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Code</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Details</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>APIError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;APIé”™è¯¯[%d]: %s (è¯¦æƒ…: %s)&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Details</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰é”™è¯¯ç±»å‹3ï¼šåŒ…è£…å…¶ä»–é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>WrappedError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Operation</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Err</span>       <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>WrappedError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;æ“ä½œ %s å¤±è´¥: %v&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Operation</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>WrappedError</span>) <span style=color:#a6e22e>Unwrap</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯çš„å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>validateUserAge</span>(<span style=color:#a6e22e>age</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>age</span> &lt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ValidationError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Field</span>:   <span style=color:#e6db74>&#34;age&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Value</span>:   <span style=color:#a6e22e>age</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>age</span> &gt; <span style=color:#ae81ff>150</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ValidationError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Field</span>:   <span style=color:#e6db74>&#34;age&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Value</span>:   <span style=color:#a6e22e>age</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;å¹´é¾„ä¸èƒ½è¶…è¿‡150å²&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>callAPI</span>(<span style=color:#a6e22e>endpoint</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>endpoint</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/admin&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>APIError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#ae81ff>403</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;æƒé™ä¸è¶³&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Details</span>: <span style=color:#e6db74>&#34;éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½è®¿é—®&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>endpoint</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/timeout&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>APIError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#ae81ff>504</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;è¯·æ±‚è¶…æ—¶&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Details</span>: <span style=color:#e6db74>&#34;æœåŠ¡å™¨å“åº”è¶…æ—¶&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processData</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>WrappedError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Operation</span>: <span style=color:#e6db74>&#34;æ•°æ®å¤„ç†&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Err</span>:       <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;è¾“å…¥æ•°æ®ä¸ºç©º&#34;</span>),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== è‡ªå®šä¹‰é”™è¯¯ç±»å‹æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•éªŒè¯é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ages</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>int</span>{<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>200</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>age</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ages</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;éªŒè¯å¹´é¾„ %d: &#34;</span>, <span style=color:#a6e22e>age</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateUserAge</span>(<span style=color:#a6e22e>age</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… éªŒè¯é€šè¿‡\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•APIé”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endpoints</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;/user&#34;</span>, <span style=color:#e6db74>&#34;/admin&#34;</span>, <span style=color:#e6db74>&#34;/timeout&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== APIè°ƒç”¨æµ‹è¯• ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>endpoint</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>endpoints</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;è°ƒç”¨ %s: &#34;</span>, <span style=color:#a6e22e>endpoint</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>callAPI</span>(<span style=color:#a6e22e>endpoint</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… è°ƒç”¨æˆåŠŸ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•åŒ…è£…é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== åŒ…è£…é”™è¯¯æµ‹è¯• ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testData</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;æœ‰æ•ˆæ•°æ®&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testData</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¤„ç†æ•°æ® &#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processData</span>(<span style=color:#a6e22e>data</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#75715e>// è§£åŒ…é”™è¯¯</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>wrapped</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>WrappedError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;    åŸå§‹é”™è¯¯: %v\n&#34;</span>, <span style=color:#a6e22e>wrapped</span>.<span style=color:#a6e22e>Err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… å¤„ç†æˆåŠŸ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> è‡ªå®šä¹‰é”™è¯¯ç±»å‹æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>éªŒè¯å¹´é¾„ -5: âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼šageï¼Œå€¼ï¼š-5ï¼ŒåŸå› ï¼šå¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°
</span></span><span style=display:flex><span>éªŒè¯å¹´é¾„ 25: âœ… éªŒè¯é€šè¿‡
</span></span><span style=display:flex><span>éªŒè¯å¹´é¾„ 200: âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼šageï¼Œå€¼ï¼š200ï¼ŒåŸå› ï¼šå¹´é¾„ä¸èƒ½è¶…è¿‡150å²
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> APIè°ƒç”¨æµ‹è¯• <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>è°ƒç”¨ /user: âœ… è°ƒç”¨æˆåŠŸ
</span></span><span style=display:flex><span>è°ƒç”¨ /admin: âŒ APIé”™è¯¯<span style=color:#f92672>[</span>403<span style=color:#f92672>]</span>: æƒé™ä¸è¶³ <span style=color:#f92672>(</span>è¯¦æƒ…: éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½è®¿é—®<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>è°ƒç”¨ /timeout: âŒ APIé”™è¯¯<span style=color:#f92672>[</span>504<span style=color:#f92672>]</span>: è¯·æ±‚è¶…æ—¶ <span style=color:#f92672>(</span>è¯¦æƒ…: æœåŠ¡å™¨å“åº”è¶…æ—¶<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> åŒ…è£…é”™è¯¯æµ‹è¯• <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¤„ç†æ•°æ® <span style=color:#e6db74>&#39;&#39;</span>: âŒ æ“ä½œ æ•°æ®å¤„ç† å¤±è´¥: è¾“å…¥æ•°æ®ä¸ºç©º
</span></span><span style=display:flex><span>    åŸå§‹é”™è¯¯: è¾“å…¥æ•°æ®ä¸ºç©º
</span></span><span style=display:flex><span>å¤„ç†æ•°æ® <span style=color:#e6db74>&#39;æœ‰æ•ˆæ•°æ®&#39;</span>: âœ… å¤„ç†æˆåŠŸ
</span></span></code></pre></div><h1 id=3-é”™è¯¯æ£€æŸ¥å’Œå¤„ç†æ¨¡å¼>3. é”™è¯¯æ£€æŸ¥å’Œå¤„ç†æ¨¡å¼</h1><h2 id=31-åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼>3.1 åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡å¼1ï¼šç«‹å³å¤„ç†é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readFileBasic</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ‰“å¼€æ–‡ä»¶å¤±è´¥ %s: %w&#34;</span>, <span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ–‡ä»¶æ“ä½œ...</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æˆåŠŸæ‰“å¼€æ–‡ä»¶ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡å¼2ï¼šé”™è¯¯ç´¯ç§¯å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processMultipleFiles</span>(<span style=color:#a6e22e>filenames</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errors</span> []<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>filename</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>filenames</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readFileBasic</span>(<span style=color:#a6e22e>filename</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>errors</span> = append(<span style=color:#a6e22e>errors</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>errors</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;å¤„ç†æ–‡ä»¶æ—¶å‘ç”Ÿ %d ä¸ªé”™è¯¯: %v&#34;</span>, len(<span style=color:#a6e22e>errors</span>), <span style=color:#a6e22e>errors</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡å¼3ï¼šé”™è¯¯é‡è¯•</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>retryOperation</span>(<span style=color:#a6e22e>operation</span> <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>maxRetries</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>lastErr</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>maxRetries</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>operation</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>  <span style=color:#75715e>// æˆåŠŸ</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>lastErr</span> = <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ç¬¬ %d æ¬¡å°è¯•å¤±è´¥ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é‡è¯• %d æ¬¡åä»ç„¶å¤±è´¥ï¼Œæœ€åé”™è¯¯ï¼š%w&#34;</span>, <span style=color:#a6e22e>maxRetries</span>, <span style=color:#a6e22e>lastErr</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡å¼4ï¼šé”™è¯¯å¿½ç•¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ignoreErrors</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åªåœ¨ç¡®å®å¯ä»¥å¿½ç•¥é”™è¯¯çš„æƒ…å†µä¸‹ä½¿ç”¨</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getwd</span>()  <span style=color:#75715e>// å¿½ç•¥é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å½“å‰ç›®å½•ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>dir</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•åŸºæœ¬æ¨¡å¼</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;1. åŸºæœ¬é”™è¯¯å¤„ç†ï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readFileBasic</span>(<span style=color:#e6db74>&#34;ä¸å­˜åœ¨çš„æ–‡ä»¶.txt&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•ç´¯ç§¯æ¨¡å¼</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n2. é”™è¯¯ç´¯ç§¯å¤„ç†ï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>files</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;file1.txt&#34;</span>, <span style=color:#e6db74>&#34;file2.txt&#34;</span>, <span style=color:#e6db74>&#34;file3.txt&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processMultipleFiles</span>(<span style=color:#a6e22e>files</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•é‡è¯•æ¨¡å¼</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n3. é”™è¯¯é‡è¯•ï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>failingOp</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ¨¡æ‹Ÿæ“ä½œå¤±è´¥&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>retryOperation</span>(<span style=color:#a6e22e>failingOp</span>, <span style=color:#ae81ff>3</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•å¿½ç•¥é”™è¯¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n4. é”™è¯¯å¿½ç•¥ï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ignoreErrors</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> åŸºæœ¬é”™è¯¯å¤„ç†æ¨¡å¼ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>1. åŸºæœ¬é”™è¯¯å¤„ç†ï¼š
</span></span><span style=display:flex><span>âŒ æ‰“å¼€æ–‡ä»¶å¤±è´¥ ä¸å­˜åœ¨çš„æ–‡ä»¶.txt: open ä¸å­˜åœ¨çš„æ–‡ä»¶.txt: The system cannot find the file specified.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2. é”™è¯¯ç´¯ç§¯å¤„ç†ï¼š
</span></span><span style=display:flex><span>âŒ å¤„ç†æ–‡ä»¶æ—¶å‘ç”Ÿ <span style=color:#ae81ff>3</span> ä¸ªé”™è¯¯: <span style=color:#f92672>[</span>æ‰“å¼€æ–‡ä»¶å¤±è´¥ file1.txt: open file1.txt: The system cannot find the file specified. æ‰“å¼€æ–‡ä»¶å¤±è´¥ file2.txt: open file2.txt: The system cannot find the file specified. æ‰“å¼€æ–‡ä»¶å¤±è´¥ file3.txt: open file3.txt: The system cannot find the file specified.<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3. é”™è¯¯é‡è¯•ï¼š
</span></span><span style=display:flex><span>ç¬¬ <span style=color:#ae81ff>1</span> æ¬¡å°è¯•å¤±è´¥ï¼šæ¨¡æ‹Ÿæ“ä½œå¤±è´¥
</span></span><span style=display:flex><span>ç¬¬ <span style=color:#ae81ff>2</span> æ¬¡å°è¯•å¤±è´¥ï¼šæ¨¡æ‹Ÿæ“ä½œå¤±è´¥
</span></span><span style=display:flex><span>ç¬¬ <span style=color:#ae81ff>3</span> æ¬¡å°è¯•å¤±è´¥ï¼šæ¨¡æ‹Ÿæ“ä½œå¤±è´¥
</span></span><span style=display:flex><span>âŒ é‡è¯• <span style=color:#ae81ff>3</span> æ¬¡åä»ç„¶å¤±è´¥ï¼Œæœ€åé”™è¯¯ï¼šæ¨¡æ‹Ÿæ“ä½œå¤±è´¥
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>4. é”™è¯¯å¿½ç•¥ï¼š
</span></span><span style=display:flex><span>å½“å‰ç›®å½•ï¼šF:<span style=color:#ae81ff>\b</span>log<span style=color:#ae81ff>\z</span>g-blog
</span></span></code></pre></div><h2 id=32-é”™è¯¯ç±»å‹æ–­è¨€å¤„ç†>3.2 é”™è¯¯ç±»å‹æ–­è¨€å¤„ç†</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ValidationError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Field</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>ValidationError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;éªŒè¯é”™è¯¯ - %s: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Field</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NetworkError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Code</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>NetworkError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;ç½‘ç»œé”™è¯¯[%d]: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parseAndValidate</span>(<span style=color:#a6e22e>input</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å°è¯•è½¬æ¢ä¸ºæ•´æ•°</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>num</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>Atoi</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ValidationError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Field</span>:   <span style=color:#e6db74>&#34;input&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;è¾“å…¥å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ•´æ•°&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// éªŒè¯æ•°å€¼èŒƒå›´</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>num</span> &lt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ValidationError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Field</span>:   <span style=color:#e6db74>&#34;number&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;æ•°å­—ä¸èƒ½ä¸ºè´Ÿæ•°&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿç½‘ç»œæ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>num</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>999</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>NetworkError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#ae81ff>503</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handleSpecificErrors</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inputs</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;abc&#34;</span>, <span style=color:#e6db74>&#34;-5&#34;</span>, <span style=color:#e6db74>&#34;999&#34;</span>, <span style=color:#e6db74>&#34;42&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>inputs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¤„ç†è¾“å…¥ &#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>parseAndValidate</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ–¹æ³•1ï¼šç±»å‹æ–­è¨€</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>validationErr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>ValidationError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼š%sï¼Œæ¶ˆæ¯ï¼š%s\n&#34;</span>, 
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>validationErr</span>.<span style=color:#a6e22e>Field</span>, <span style=color:#a6e22e>validationErr</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ–¹æ³•2ï¼šç±»å‹é€‰æ‹©</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>specificErr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>NetworkError</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ ç½‘ç»œé”™è¯¯ - ä»£ç ï¼š%dï¼Œæ¶ˆæ¯ï¼š%s\n&#34;</span>, 
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>specificErr</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>specificErr</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>ValidationError</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼š%sï¼Œæ¶ˆæ¯ï¼š%s\n&#34;</span>, 
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>specificErr</span>.<span style=color:#a6e22e>Field</span>, <span style=color:#a6e22e>specificErr</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ æœªçŸ¥é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… å¤„ç†æˆåŠŸ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== é”™è¯¯ç±»å‹æ–­è¨€å¤„ç† ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>handleSpecificErrors</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== æ–‡ä»¶é”™è¯¯å¤„ç† ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filenames</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;existing.txt&#34;</span>, <span style=color:#e6db74>&#34;missing.txt&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>filename</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>filenames</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ£€æŸ¥æ–‡ä»¶ &#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stat</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>IsNotExist</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ æ–‡ä»¶ä¸å­˜åœ¨\n&#34;</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>IsPermission</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ æƒé™ä¸è¶³\n&#34;</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ å…¶ä»–é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… æ–‡ä»¶å­˜åœ¨\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯ç±»å‹æ–­è¨€å¤„ç† <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¤„ç†è¾“å…¥ <span style=color:#e6db74>&#39;abc&#39;</span>: âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼šinputï¼Œæ¶ˆæ¯ï¼šè¾“å…¥å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ•´æ•°
</span></span><span style=display:flex><span>å¤„ç†è¾“å…¥ <span style=color:#e6db74>&#39;-5&#39;</span>: âŒ éªŒè¯é”™è¯¯ - å­—æ®µï¼šnumberï¼Œæ¶ˆæ¯ï¼šæ•°å­—ä¸èƒ½ä¸ºè´Ÿæ•°
</span></span><span style=display:flex><span>å¤„ç†è¾“å…¥ <span style=color:#e6db74>&#39;999&#39;</span>: âŒ ç½‘ç»œé”™è¯¯ - ä»£ç ï¼š503ï¼Œæ¶ˆæ¯ï¼šæœåŠ¡æš‚æ—¶ä¸å¯ç”¨
</span></span><span style=display:flex><span>å¤„ç†è¾“å…¥ <span style=color:#e6db74>&#39;42&#39;</span>: âœ… å¤„ç†æˆåŠŸ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> æ–‡ä»¶é”™è¯¯å¤„ç† <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ£€æŸ¥æ–‡ä»¶ <span style=color:#e6db74>&#39;existing.txt&#39;</span>: âœ… æ–‡ä»¶å­˜åœ¨
</span></span><span style=display:flex><span>æ£€æŸ¥æ–‡ä»¶ <span style=color:#e6db74>&#39;missing.txt&#39;</span>: âŒ æ–‡ä»¶ä¸å­˜åœ¨
</span></span></code></pre></div><h1 id=4-é”™è¯¯åŒ…è£…å’Œä¸Šä¸‹æ–‡>4. é”™è¯¯åŒ…è£…å’Œä¸Šä¸‹æ–‡</h1><h2 id=41-errorsåŒ…çš„æ–°åŠŸèƒ½go-113>4.1 errorsåŒ…çš„æ–°åŠŸèƒ½ï¼ˆGo 1.13+ï¼‰</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>databaseQuery</span>(<span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;invalid&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“æŸ¥è¯¢è¯­æ³•é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;timeout&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“è¿æ¥è¶…æ—¶&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¸šåŠ¡å±‚å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getUserData</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// éªŒè¯ç”¨æˆ·ID</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>userID</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·IDä¸èƒ½ä¸ºç©º&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æŸ¥è¯¢æ•°æ®åº“</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>databaseQuery</span>(<span style=color:#e6db74>&#34;SELECT * FROM users WHERE id = &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>userID</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>err</span>)  <span style=color:#75715e>// åŒ…è£…é”™è¯¯</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æœåŠ¡å±‚å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handleUserRequest</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getUserData</span>(<span style=color:#a6e22e>userID</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;å¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>err</span>)  <span style=color:#75715e>// å†æ¬¡åŒ…è£…</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateErrorWrapping</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userIDs</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;invalid&#34;</span>, <span style=color:#e6db74>&#34;timeout&#34;</span>, <span style=color:#e6db74>&#34;123&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>userID</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>userIDs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¤„ç†ç”¨æˆ·è¯·æ±‚ UserID=&#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>handleUserRequest</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ£€æŸ¥ç‰¹å®šé”™è¯¯</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ErrNotExist</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;    åŸå› ï¼šæ–‡ä»¶ä¸å­˜åœ¨\n&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„é”™è¯¯</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pathError</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>PathError</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>As</span>(<span style=color:#a6e22e>err</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pathError</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;    è·¯å¾„é”™è¯¯ï¼šæ“ä½œ=%sï¼Œè·¯å¾„=%s\n&#34;</span>, 
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>pathError</span>.<span style=color:#a6e22e>Op</span>, <span style=color:#a6e22e>pathError</span>.<span style=color:#a6e22e>Path</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ‰“å°é”™è¯¯é“¾</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;    é”™è¯¯é“¾ï¼š&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Unwrap</span>(<span style=color:#a6e22e>err</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34; -&gt; &#34;</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… è¯·æ±‚å¤„ç†æˆåŠŸ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰å¯åŒ…è£…é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CustomError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Code</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Err</span>     <span style=color:#66d9ef>error</span>  <span style=color:#75715e>// åµŒå…¥åº•å±‚é”™è¯¯</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>CustomError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;è‡ªå®šä¹‰é”™è¯¯[%d]: %s (åŸå› : %v)&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;è‡ªå®šä¹‰é”™è¯¯[%d]: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>CustomError</span>) <span style=color:#a6e22e>Unwrap</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== é”™è¯¯åŒ…è£…å’Œä¸Šä¸‹æ–‡ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateErrorWrapping</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è‡ªå®šä¹‰é”™è¯¯åŒ…è£…ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== è‡ªå®šä¹‰é”™è¯¯åŒ…è£… ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>baseErr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;åº•å±‚é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wrappedErr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>CustomError</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Code</span>:    <span style=color:#ae81ff>1001</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;ä¸šåŠ¡é€»è¾‘é”™è¯¯&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Err</span>:     <span style=color:#a6e22e>baseErr</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;åŒ…è£…é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>wrappedErr</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;åº•å±‚é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Unwrap</span>(<span style=color:#a6e22e>wrappedErr</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ˜¯å¦æœ‰åº•å±‚é”™è¯¯ï¼š%t\n&#34;</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>wrappedErr</span>, <span style=color:#a6e22e>baseErr</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯åŒ…è£…å’Œä¸Šä¸‹æ–‡ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¤„ç†ç”¨æˆ·è¯·æ±‚ UserID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>: âŒ å¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: ç”¨æˆ·IDä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>    é”™è¯¯é“¾ï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: ç”¨æˆ·IDä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å¤„ç†ç”¨æˆ·è¯·æ±‚ UserID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;invalid&#39;</span>: âŒ å¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: æ•°æ®åº“æŸ¥è¯¢è¯­æ³•é”™è¯¯
</span></span><span style=display:flex><span>    é”™è¯¯é“¾ï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: æ•°æ®åº“æŸ¥è¯¢è¯­æ³•é”™è¯¯
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å¤„ç†ç”¨æˆ·è¯·æ±‚ UserID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;timeout&#39;</span>: âŒ å¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: æ•°æ®åº“è¿æ¥è¶…æ—¶
</span></span><span style=display:flex><span>    é”™è¯¯é“¾ï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚å¤±è´¥: è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: æ•°æ®åº“è¿æ¥è¶…æ—¶
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å¤„ç†ç”¨æˆ·è¯·æ±‚ UserID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;123&#39;</span>: âœ… è¯·æ±‚å¤„ç†æˆåŠŸ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> è‡ªå®šä¹‰é”™è¯¯åŒ…è£… <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>åŒ…è£…é”™è¯¯ï¼šè‡ªå®šä¹‰é”™è¯¯<span style=color:#f92672>[</span>1001<span style=color:#f92672>]</span>: ä¸šåŠ¡é€»è¾‘é”™è¯¯ <span style=color:#f92672>(</span>åŸå› : åº•å±‚é”™è¯¯<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>åº•å±‚é”™è¯¯ï¼šåº•å±‚é”™è¯¯
</span></span><span style=display:flex><span>æ˜¯å¦æœ‰åº•å±‚é”™è¯¯ï¼štrue
</span></span></code></pre></div><h2 id=42-å¤šé”™è¯¯å¤„ç†>4.2 å¤šé”™è¯¯å¤„ç†</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// é”™è¯¯é›†åˆç±»å‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ErrorCollection</span> []<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>ec</span> <span style=color:#a6e22e>ErrorCollection</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>ec</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errorMsgs</span> []<span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ec</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errorMsgs</span> = append(<span style=color:#a6e22e>errorMsgs</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;å‘ç”Ÿ %d ä¸ªé”™è¯¯: %s&#34;</span>, 
</span></span><span style=display:flex><span>                      len(<span style=color:#a6e22e>ec</span>), <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>errorMsgs</span>, <span style=color:#e6db74>&#34;; &#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¹¶è¡Œä»»åŠ¡å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processTasks</span>(<span style=color:#a6e22e>taskNames</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errorsList</span> <span style=color:#a6e22e>ErrorCollection</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿå¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>taskName</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>taskNames</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processSingleTask</span>(<span style=color:#a6e22e>taskName</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>errorsList</span> = append(<span style=color:#a6e22e>errorsList</span>, 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡ &#39;%s&#39; å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>taskName</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>errorsList</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errorsList</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processSingleTask</span>(<span style=color:#a6e22e>taskName</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>taskName</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;task1&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç½‘ç»œè¿æ¥å¤±è´¥&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;task2&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ–‡ä»¶ä¸å­˜åœ¨&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;task3&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>  <span style=color:#75715e>// æˆåŠŸ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;task4&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æƒé™ä¸è¶³&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æœªçŸ¥ä»»åŠ¡&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// é”™è¯¯åˆ†ç»„å¤„ç†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>handleGroupedErrors</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>taskGroups</span> <span style=color:#f92672>:=</span> [][]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;task1&#34;</span>, <span style=color:#e6db74>&#34;task2&#34;</span>, <span style=color:#e6db74>&#34;task3&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;task3&#34;</span>, <span style=color:#e6db74>&#34;task4&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;task1&#34;</span>, <span style=color:#e6db74>&#34;task4&#34;</span>, <span style=color:#e6db74>&#34;task5&#34;</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>tasks</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>taskGroups</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¤„ç†ä»»åŠ¡ç»„ %d %v:\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>tasks</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processTasks</span>(<span style=color:#a6e22e>tasks</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errorCollection</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>ErrorCollection</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  âŒ å‘ç”Ÿ %d ä¸ªé”™è¯¯:\n&#34;</span>, len(<span style=color:#a6e22e>errorCollection</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>singleErr</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>errorCollection</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;    %d. %v\n&#34;</span>, <span style=color:#a6e22e>j</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>singleErr</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  âŒ å•ä¸ªé”™è¯¯: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;  âœ… æ‰€æœ‰ä»»åŠ¡æˆåŠŸå®Œæˆ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== å¤šé”™è¯¯å¤„ç† ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>handleGroupedErrors</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// é”™è¯¯åˆå¹¶ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== é”™è¯¯åˆå¹¶ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç¬¬ä¸€ä¸ªé”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç¬¬äºŒä¸ªé”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err3</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç¬¬ä¸‰ä¸ªé”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>combined</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ErrorCollection</span>{<span style=color:#a6e22e>err1</span>, <span style=color:#a6e22e>err2</span>, <span style=color:#a6e22e>err3</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;åˆå¹¶é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>combined</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç©ºé”™è¯¯é›†åˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>empty</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ErrorCollection</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ç©ºé”™è¯¯é›†åˆï¼š%vï¼Œæ˜¯å¦ä¸ºnilï¼š%t\n&#34;</span>, <span style=color:#a6e22e>empty</span>, <span style=color:#a6e22e>empty</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> å¤šé”™è¯¯å¤„ç† <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¤„ç†ä»»åŠ¡ç»„ <span style=color:#ae81ff>1</span> <span style=color:#f92672>[</span>task1 task2 task3<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>  âŒ å‘ç”Ÿ <span style=color:#ae81ff>2</span> ä¸ªé”™è¯¯:
</span></span><span style=display:flex><span>    1. ä»»åŠ¡ <span style=color:#e6db74>&#39;task1&#39;</span> å¤±è´¥: ç½‘ç»œè¿æ¥å¤±è´¥
</span></span><span style=display:flex><span>    2. ä»»åŠ¡ <span style=color:#e6db74>&#39;task2&#39;</span> å¤±è´¥: æ–‡ä»¶ä¸å­˜åœ¨
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å¤„ç†ä»»åŠ¡ç»„ <span style=color:#ae81ff>2</span> <span style=color:#f92672>[</span>task3 task4<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>  âŒ å‘ç”Ÿ <span style=color:#ae81ff>1</span> ä¸ªé”™è¯¯:
</span></span><span style=display:flex><span>    1. ä»»åŠ¡ <span style=color:#e6db74>&#39;task4&#39;</span> å¤±è´¥: æƒé™ä¸è¶³
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å¤„ç†ä»»åŠ¡ç»„ <span style=color:#ae81ff>3</span> <span style=color:#f92672>[</span>task1 task4 task5<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>  âŒ å‘ç”Ÿ <span style=color:#ae81ff>3</span> ä¸ªé”™è¯¯:
</span></span><span style=display:flex><span>    1. ä»»åŠ¡ <span style=color:#e6db74>&#39;task1&#39;</span> å¤±è´¥: ç½‘ç»œè¿æ¥å¤±è´¥
</span></span><span style=display:flex><span>    2. ä»»åŠ¡ <span style=color:#e6db74>&#39;task4&#39;</span> å¤±è´¥: æƒé™ä¸è¶³
</span></span><span style=display:flex><span>    3. ä»»åŠ¡ <span style=color:#e6db74>&#39;task5&#39;</span> å¤±è´¥: æœªçŸ¥ä»»åŠ¡
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯åˆå¹¶ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>åˆå¹¶é”™è¯¯ï¼šå‘ç”Ÿ <span style=color:#ae81ff>3</span> ä¸ªé”™è¯¯: ç¬¬ä¸€ä¸ªé”™è¯¯; ç¬¬äºŒä¸ªé”™è¯¯; ç¬¬ä¸‰ä¸ªé”™è¯¯
</span></span><span style=display:flex><span>ç©ºé”™è¯¯é›†åˆï¼šï¼Œæ˜¯å¦ä¸ºnilï¼štrue
</span></span></code></pre></div><h1 id=5-å®é™…åº”ç”¨ä¸­çš„é”™è¯¯å¤„ç†>5. å®é™…åº”ç”¨ä¸­çš„é”™è¯¯å¤„ç†</h1><h2 id=51-webæœåŠ¡é”™è¯¯å¤„ç†>5.1 WebæœåŠ¡é”™è¯¯å¤„ç†</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// APIé”™è¯¯å“åº”ç»“æ„</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>APIErrorResponse</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Error</span>   <span style=color:#66d9ef>bool</span>   <span style=color:#e6db74>`json:&#34;error&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Code</span>    <span style=color:#66d9ef>int</span>    <span style=color:#e6db74>`json:&#34;code&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;message&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Time</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;time&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰HTTPé”™è¯¯ç±»å‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HTTPError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Code</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Err</span>     <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>HTTPError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;HTTP %d: %s (åŸå› : %v)&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;HTTP %d: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>errorHandler</span>(<span style=color:#a6e22e>next</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span>) <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandlerFunc</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> recover(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ææ…Œæ¢å¤ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>sendErrorResponse</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>, <span style=color:#e6db74>&#34;å†…éƒ¨æœåŠ¡å™¨é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>next</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å‘é€é”™è¯¯å“åº”</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sendErrorResponse</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>code</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>response</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>APIErrorResponse</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Error</span>:   <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Code</span>:    <span style=color:#a6e22e>code</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Message</span>: <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Time</span>:    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>code</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>w</span>).<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>response</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;JSONç¼–ç é”™è¯¯ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserService</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserService</span>) <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>HTTPError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;ç”¨æˆ·IDä¸èƒ½ä¸ºç©º&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;admin&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>HTTPError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusForbidden</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;ç¦æ­¢è®¿é—®ç®¡ç†å‘˜è´¦æˆ·&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;missing&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>HTTPError</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Code</span>:    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusNotFound</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;ç”¨æˆ·ä¸å­˜åœ¨&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æˆåŠŸæƒ…å†µ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;id&#34;</span>:   <span style=color:#a6e22e>id</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·%s&#34;</span>, <span style=color:#a6e22e>id</span>),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;age&#34;</span>:  <span style=color:#ae81ff>25</span>,
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// HTTPå¤„ç†å™¨</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>userHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userService</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserService</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>userService</span>.<span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>httpErr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>HTTPError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sendErrorResponse</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>httpErr</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>httpErr</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sendErrorResponse</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>, <span style=color:#e6db74>&#34;å†…éƒ¨é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æˆåŠŸå“åº”</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>w</span>).<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateWebErrors</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹ŸHTTPè¯·æ±‚å¤„ç†</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testCases</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;admin&#34;</span>, <span style=color:#e6db74>&#34;missing&#34;</span>, <span style=color:#e6db74>&#34;normal&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== WebæœåŠ¡é”™è¯¯å¤„ç†æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>userID</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testCases</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;è¯·æ±‚ç”¨æˆ·ID &#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ¨¡æ‹Ÿè¯·æ±‚</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>userService</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserService</span>{}
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>userService</span>.<span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>httpErr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>HTTPError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ HTTPé”™è¯¯ %d: %s\n&#34;</span>, <span style=color:#a6e22e>httpErr</span>.<span style=color:#a6e22e>Code</span>, <span style=color:#a6e22e>httpErr</span>.<span style=color:#a6e22e>Message</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ æœªçŸ¥é”™è¯¯: %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… æˆåŠŸè·å–ç”¨æˆ·: %+v\n&#34;</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateWebErrors</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨HTTPæœåŠ¡å™¨ç¤ºä¾‹ï¼ˆæ³¨é‡Šæ‰é¿å…å®é™…å¯åŠ¨ï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>    http.HandleFunc(&#34;/user&#34;, errorHandler(userHandler))
</span></span></span><span style=display:flex><span><span style=color:#75715e>    fmt.Println(&#34;æœåŠ¡å™¨å¯åŠ¨åœ¨ :8080&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e>    http.ListenAndServe(&#34;:8080&#34;, nil)
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// é”™è¯¯æ—¥å¿—è®°å½•ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== é”™è¯¯æ—¥å¿—è®°å½• ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logError</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>operation</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[%s] ERROR: %v\n&#34;</span>, 
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02 15:04:05&#34;</span>), <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿå„ç§é”™è¯¯åœºæ™¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errorsToLog</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>error</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“è¿æ¥å¤±è´¥&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ–‡ä»¶è¯»å–é”™è¯¯: %w&#34;</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æƒé™ä¸è¶³&#34;</span>)),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>HTTPError</span>{<span style=color:#a6e22e>Code</span>: <span style=color:#ae81ff>500</span>, <span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;å†…éƒ¨æœåŠ¡å™¨é”™è¯¯&#34;</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>errorsToLog</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>logError</span>(<span style=color:#e6db74>&#34;æ•°æ®å¤„ç†&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> WebæœåŠ¡é”™è¯¯å¤„ç†æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>è¯·æ±‚ç”¨æˆ·ID <span style=color:#e6db74>&#39;&#39;</span>: âŒ HTTPé”™è¯¯ 400: ç”¨æˆ·IDä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>è¯·æ±‚ç”¨æˆ·ID <span style=color:#e6db74>&#39;admin&#39;</span>: âŒ HTTPé”™è¯¯ 403: ç¦æ­¢è®¿é—®ç®¡ç†å‘˜è´¦æˆ·
</span></span><span style=display:flex><span>è¯·æ±‚ç”¨æˆ·ID <span style=color:#e6db74>&#39;missing&#39;</span>: âŒ HTTPé”™è¯¯ 404: ç”¨æˆ·ä¸å­˜åœ¨
</span></span><span style=display:flex><span>è¯·æ±‚ç”¨æˆ·ID <span style=color:#e6db74>&#39;normal&#39;</span>: âœ… æˆåŠŸè·å–ç”¨æˆ·: map<span style=color:#f92672>[</span>age:25 id:normal name:ç”¨æˆ·normal<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯æ—¥å¿—è®°å½• <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2024-01-15 15:30:45<span style=color:#f92672>]</span> ERROR: æ•°æ®åº“è¿æ¥å¤±è´¥
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2024-01-15 15:30:45<span style=color:#f92672>]</span> ERROR: æ–‡ä»¶è¯»å–é”™è¯¯: æƒé™ä¸è¶³
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2024-01-15 15:30:45<span style=color:#f92672>]</span> ERROR: HTTP 500: å†…éƒ¨æœåŠ¡å™¨é”™è¯¯
</span></span></code></pre></div><h2 id=52-æ•°æ®åº“æ“ä½œé”™è¯¯å¤„ç†>5.2 æ•°æ®åº“æ“ä½œé”™è¯¯å¤„ç†</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;database/sql&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡æ‹Ÿæ•°æ®åº“é©±åŠ¨</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MockDB</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tables</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>][]<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewMockDB</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MockDB</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tables</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>][]<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>) <span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) (<span style=color:#f92672>*</span><span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Rows</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;invalid sql&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;SQLè¯­æ³•é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;timeout&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æŸ¥è¯¢è¶…æ—¶&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹ŸæˆåŠŸæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Rows</span>{}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>) <span style=color:#a6e22e>Exec</span>(<span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) (<span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Result</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;duplicate key&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;è¿åå”¯ä¸€çº¦æŸ&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;foreign key violation&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;å¤–é”®çº¦æŸè¿è§„&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>mockResult</span>{<span style=color:#a6e22e>rowsAffected</span>: <span style=color:#ae81ff>1</span>}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>mockResult</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rowsAffected</span> <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>mockResult</span>) <span style=color:#a6e22e>LastInsertId</span>() (<span style=color:#66d9ef>int64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>mockResult</span>) <span style=color:#a6e22e>RowsAffected</span>() (<span style=color:#66d9ef>int64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>rowsAffected</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ•°æ®è®¿é—®å±‚</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewUserRepository</span>(<span style=color:#a6e22e>db</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>UserRepository</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserRepository</span>{<span style=color:#a6e22e>db</span>: <span style=color:#a6e22e>db</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserRepository</span>) <span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>user</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// éªŒè¯ç”¨æˆ·æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;name&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;name&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;email&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;email&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é‚®ç®±ä¸èƒ½ä¸ºç©º&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ‰§è¡Œæ•°æ®åº“æ’å…¥</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>query</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;INSERT INTO users (name, email) VALUES (?, ?)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Exec</span>(<span style=color:#a6e22e>query</span>, <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;name&#34;</span>], <span style=color:#a6e22e>user</span>[<span style=color:#e6db74>&#34;email&#34;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹è¿”å›ä¸åŒçš„ä¸šåŠ¡é”™è¯¯</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;è¿åå”¯ä¸€çº¦æŸ&#34;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é‚®ç®±åœ°å€å·²å­˜åœ¨ï¼š%w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;å¤–é”®çº¦æŸè¿è§„&#34;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;å…³è”æ•°æ®ä¸å­˜åœ¨ï¼š%w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“æ“ä½œå¤±è´¥ï¼š%w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserRepository</span>) <span style=color:#a6e22e>FindUserByEmail</span>(<span style=color:#a6e22e>email</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>email</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é‚®ç®±åœ°å€ä¸èƒ½ä¸ºç©º&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>query</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;SELECT * FROM users WHERE email = ?&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rows</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>query</span>, <span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æŸ¥è¯¢ç”¨æˆ·å¤±è´¥ï¼š%w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>rows</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹ŸæŸ¥è¯¢ç»“æœ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>email</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;notfound@example.com&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·ä¸å­˜åœ¨&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;id&#34;</span>:    <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;name&#34;</span>:  <span style=color:#e6db74>&#34;å¼ ä¸‰&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#a6e22e>email</span>,
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateDatabaseErrors</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>db</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewMockDB</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repo</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewUserRepository</span>(<span style=color:#a6e22e>db</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== æ•°æ®åº“é”™è¯¯å¤„ç†æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•åˆ›å»ºç”¨æˆ·çš„å„ç§é”™è¯¯æƒ…å†µ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testUsers</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;test@example.com&#34;</span>},           <span style=color:#75715e>// åå­—ä¸ºç©º</span>
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;å¼ ä¸‰&#34;</span>, <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>},                       <span style=color:#75715e>// é‚®ç®±ä¸ºç©º</span>
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;æå››&#34;</span>, <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;duplicate@example.com&#34;</span>},  <span style=color:#75715e>// é‚®ç®±é‡å¤</span>
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;ç‹äº”&#34;</span>, <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;valid@example.com&#34;</span>},      <span style=color:#75715e>// æ­£å¸¸æƒ…å†µ</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>user</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testUsers</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æµ‹è¯•%d - åˆ›å»ºç”¨æˆ· %+v: &#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>repo</span>.<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… åˆ›å»ºæˆåŠŸ\n&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æµ‹è¯•æŸ¥è¯¢ç”¨æˆ·</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== æŸ¥è¯¢ç”¨æˆ·æµ‹è¯• ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testEmails</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;</span>,                           <span style=color:#75715e>// ç©ºé‚®ç®±</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;notfound@example.com&#34;</span>,       <span style=color:#75715e>// ç”¨æˆ·ä¸å­˜åœ¨</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;valid@example.com&#34;</span>,          <span style=color:#75715e>// æ­£å¸¸æŸ¥è¯¢</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>email</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testEmails</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æŸ¥è¯¢é‚®ç®± &#39;%s&#39;: &#34;</span>, <span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>repo</span>.<span style=color:#a6e22e>FindUserByEmail</span>(<span style=color:#a6e22e>email</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… æ‰¾åˆ°ç”¨æˆ·: %+v\n&#34;</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateDatabaseErrors</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// äº‹åŠ¡é”™è¯¯å¤„ç†ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== äº‹åŠ¡é”™è¯¯å¤„ç† ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>simulateTransaction</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¼€å§‹äº‹åŠ¡</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å¼€å§‹äº‹åŠ¡...&#34;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç”¨æˆ·</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;åˆ›å»ºç”¨æˆ·å¤±è´¥&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ äº‹åŠ¡æ­¥éª¤1å¤±è´¥ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;äº‹åŠ¡å›æ»šï¼šåˆ›å»ºç”¨æˆ·å¤±è´¥ - %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç”¨æˆ·èµ„æ–™</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;åˆ›å»ºèµ„æ–™å¤±è´¥&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ äº‹åŠ¡æ­¥éª¤2å¤±è´¥ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;äº‹åŠ¡å›æ»šï¼šåˆ›å»ºèµ„æ–™å¤±è´¥ - %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ç¬¬ä¸‰æ­¥ï¼šå‘é€æ¬¢è¿é‚®ä»¶</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;å‘é€é‚®ä»¶å¤±è´¥&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âš ï¸  éå…³é”®æ­¥éª¤å¤±è´¥ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#75715e>// éå…³é”®æ­¥éª¤å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©ç»§ç»­</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;âœ… äº‹åŠ¡æäº¤æˆåŠŸ&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>simulateTransaction</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;äº‹åŠ¡æœ€ç»ˆå¤±è´¥ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> æ•°æ®åº“é”™è¯¯å¤„ç†æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æµ‹è¯•1 - åˆ›å»ºç”¨æˆ· map<span style=color:#f92672>[</span>email:test@example.com name:<span style=color:#f92672>]</span>: âŒ ç”¨æˆ·åä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>æµ‹è¯•2 - åˆ›å»ºç”¨æˆ· map<span style=color:#f92672>[</span>email: name:å¼ ä¸‰<span style=color:#f92672>]</span>: âŒ é‚®ç®±ä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>æµ‹è¯•3 - åˆ›å»ºç”¨æˆ· map<span style=color:#f92672>[</span>email:duplicate@example.com name:æå››<span style=color:#f92672>]</span>: âŒ é‚®ç®±åœ°å€å·²å­˜åœ¨ï¼šè¿åå”¯ä¸€çº¦æŸ
</span></span><span style=display:flex><span>æµ‹è¯•4 - åˆ›å»ºç”¨æˆ· map<span style=color:#f92672>[</span>email:valid@example.com name:ç‹äº”<span style=color:#f92672>]</span>: âœ… åˆ›å»ºæˆåŠŸ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> æŸ¥è¯¢ç”¨æˆ·æµ‹è¯• <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æŸ¥è¯¢é‚®ç®± <span style=color:#e6db74>&#39;&#39;</span>: âŒ é‚®ç®±åœ°å€ä¸èƒ½ä¸ºç©º
</span></span><span style=display:flex><span>æŸ¥è¯¢é‚®ç®± <span style=color:#e6db74>&#39;notfound@example.com&#39;</span>: âŒ ç”¨æˆ·ä¸å­˜åœ¨
</span></span><span style=display:flex><span>æŸ¥è¯¢é‚®ç®± <span style=color:#e6db74>&#39;valid@example.com&#39;</span>: âœ… æ‰¾åˆ°ç”¨æˆ·: map<span style=color:#f92672>[</span>email:valid@example.com id:1 name:å¼ ä¸‰<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> äº‹åŠ¡é”™è¯¯å¤„ç† <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¼€å§‹äº‹åŠ¡...
</span></span><span style=display:flex><span>âŒ äº‹åŠ¡æ­¥éª¤1å¤±è´¥ï¼šåˆ›å»ºç”¨æˆ·å¤±è´¥
</span></span><span style=display:flex><span>äº‹åŠ¡æœ€ç»ˆå¤±è´¥ï¼šäº‹åŠ¡å›æ»šï¼šåˆ›å»ºç”¨æˆ·å¤±è´¥ - åˆ›å»ºç”¨æˆ·å¤±è´¥
</span></span></code></pre></div><h1 id=6-é”™è¯¯å¤„ç†æœ€ä½³å®è·µ>6. é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</h1><h2 id=61-é”™è¯¯å¤„ç†åŸåˆ™>6.1 é”™è¯¯å¤„ç†åŸåˆ™</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¥½çš„é”™è¯¯å¤„ç†å®è·µ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 1. åŠæ—¶å¤„ç†é”™è¯¯ï¼Œä¸è¦å»¶è¿Ÿ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>goodErrorHandling1</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readConfig</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;è¯»å–é…ç½®å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>err</span>)  <span style=color:#75715e>// ç«‹å³å¤„ç†</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateConfig</span>(<span style=color:#a6e22e>data</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é…ç½®éªŒè¯å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>err</span>)  <span style=color:#75715e>// ç«‹å³å¤„ç†</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>goodErrorHandling2</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>openFile</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¥½çš„é”™è¯¯ä¿¡æ¯åŒ…å«ä¸Šä¸‹æ–‡</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ— æ³•æ‰“å¼€é…ç½®æ–‡ä»¶ &#39;%s&#39;: %w&#34;</span>, <span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>goodErrorHandling3</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>findUser</span>(<span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ ¹æ®é”™è¯¯ç±»å‹é‡‡å–ä¸åŒè¡ŒåŠ¨</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>ErrUserNotFound</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œ&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>ErrDatabaseDown</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>IsActive</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·è´¦å·å·²è¢«ç¦ç”¨&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 4. è®°å½•é”™è¯¯ä½†ä¸æš´éœ²å†…éƒ¨ç»†èŠ‚</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>goodErrorHandling4</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sensitiveOperation</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è®°å½•è¯¦ç»†é”™è¯¯åˆ°æ—¥å¿—</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ•æ„Ÿæ“ä½œå¤±è´¥ï¼ˆå†…éƒ¨é”™è¯¯ï¼‰ï¼š%+v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è¿”å›é€šç”¨é”™è¯¯ç»™ç”¨æˆ·</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ“ä½œå¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡æ‹Ÿå‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readConfig</span>() (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ–‡ä»¶ä¸å­˜åœ¨&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>validateConfig</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;é…ç½®æ ¼å¼é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>openFile</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æƒé™è¢«æ‹’ç»&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrUserNotFound</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·ä¸å­˜åœ¨&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrDatabaseDown</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“å®•æœº&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>findUser</span>(<span style=color:#a6e22e>userID</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>ErrUserNotFound</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>IsActive</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sensitiveOperation</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;å†…éƒ¨æ•°æ®åº“å‡­è¯æ³„éœ²&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¸å¥½çš„é”™è¯¯å¤„ç†å®è·µ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 1. å¿½ç•¥é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>badErrorHandling1</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readConfig</span>()  <span style=color:#75715e>// é”™è¯¯è¢«å¿½ç•¥</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>processConfig</span>(<span style=color:#a6e22e>data</span>)      <span style=color:#75715e>// å¯èƒ½ä½¿ç”¨nilæ•°æ®</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>badErrorHandling2</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>openFile</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>  <span style=color:#75715e>// é”™è¯¯ä¿¡æ¯å¤ªç®€å•</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. è¿‡åº¦åŒ…è£…é”™è¯¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>badErrorHandling3</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lowLevelError</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;é«˜å±‚é”™è¯¯: %w&#34;</span>, 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;ä¸­å±‚é”™è¯¯: %w&#34;</span>, 
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;åº•å±‚é”™è¯¯: %w&#34;</span>, <span style=color:#a6e22e>err</span>)))  <span style=color:#75715e>// è¿‡åº¦åŒ…è£…</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>lowLevelError</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;åº•å±‚é”™è¯¯&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processConfig</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¤„ç†é…ç½®</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== é”™è¯¯å¤„ç†æœ€ä½³å®è·µ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å¥½çš„å®è·µç¤ºä¾‹ï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>goodErrorHandling1</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>goodErrorHandling2</span>(<span style=color:#e6db74>&#34;config.json&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>goodErrorHandling3</span>(<span style=color:#e6db74>&#34;user123&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âŒ %v\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>goodErrorHandling4</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\né¿å…çš„åå®è·µï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;1. å¿½ç•¥é”™è¯¯å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;2. ä¸æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯éš¾ä»¥è°ƒè¯•&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;3. è¿‡åº¦åŒ…è£…ä½¿é”™è¯¯é“¾è¿‡äºå¤æ‚&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¼”ç¤ºé”™è¯¯æ—¥å¿—çš„æœ€ä½³å®è·µ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== é”™è¯¯æ—¥å¿—æœ€ä½³å®è·µ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logError</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†æ—¥å¿—</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[DEBUG] %s å¤±è´¥: %+v&#34;</span>, <span style=color:#a6e22e>context</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ç”Ÿäº§ç¯å¢ƒï¼šç®€åŒ–æ—¥å¿—</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] %s å¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—&#34;</span>, <span style=color:#a6e22e>context</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿé”™è¯¯è®°å½•</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sampleErr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“è¿æ¥å¤±è´¥: %w&#34;</span>, 
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ç½‘ç»œè¶…æ—¶&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logError</span>(<span style=color:#e6db74>&#34;ç”¨æˆ·ç™»å½•&#34;</span>, <span style=color:#a6e22e>sampleErr</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯å¤„ç†æœ€ä½³å®è·µ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¥½çš„å®è·µç¤ºä¾‹ï¼š
</span></span><span style=display:flex><span>âŒ è¯»å–é…ç½®å¤±è´¥: æ–‡ä»¶ä¸å­˜åœ¨
</span></span><span style=display:flex><span>âŒ æ— æ³•æ‰“å¼€é…ç½®æ–‡ä»¶ <span style=color:#e6db74>&#39;config.json&#39;</span>: æƒé™è¢«æ‹’ç»
</span></span><span style=display:flex><span>âŒ ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œ
</span></span><span style=display:flex><span>æ“ä½œå¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>é¿å…çš„åå®è·µï¼š
</span></span><span style=display:flex><span>1. å¿½ç•¥é”™è¯¯å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ
</span></span><span style=display:flex><span>2. ä¸æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯éš¾ä»¥è°ƒè¯•
</span></span><span style=display:flex><span>3. è¿‡åº¦åŒ…è£…ä½¿é”™è¯¯é“¾è¿‡äºå¤æ‚
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> é”™è¯¯æ—¥å¿—æœ€ä½³å®è·µ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>2024/01/15 15:30:45 <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> ç”¨æˆ·ç™»å½• å¤±è´¥: æ•°æ®åº“è¿æ¥å¤±è´¥: ç½‘ç»œè¶…æ—¶
</span></span><span style=display:flex><span>2024/01/15 15:30:45 <span style=color:#f92672>[</span>ERROR<span style=color:#f92672>]</span> ç”¨æˆ·ç™»å½• å¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
</span></span></code></pre></div><h1 id=7-æ€»ç»“>7. æ€»ç»“</h1><p>Goè¯­è¨€çš„é”™è¯¯å¤„ç†æœºåˆ¶ä½“ç°äº†å…¶"ç®€å•ã€æ˜ç¡®ã€å®ç”¨"çš„è®¾è®¡å“²å­¦ï¼š</p><p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p><ul><li>é”™è¯¯æ˜¯å€¼ï¼Œåº”è¯¥è¢«æ˜¾å¼æ£€æŸ¥å’Œå¤„ç†</li><li>ä½¿ç”¨erroræ¥å£ç»Ÿä¸€é”™è¯¯è¡¨ç¤º</li><li>é€šè¿‡errorsåŒ…æä¾›ç°ä»£é”™è¯¯å¤„ç†åŠŸèƒ½</li><li>åˆç†ä½¿ç”¨é”™è¯¯åŒ…è£…å’Œä¸Šä¸‹æ–‡ä¿¡æ¯</li></ul><p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p><ol><li><strong>åŠæ—¶å¤„ç†</strong>ï¼šå‘ç°é”™è¯¯ç«‹å³å¤„ç†ï¼Œä¸è¦å»¶è¿Ÿ</li><li><strong>æä¾›ä¸Šä¸‹æ–‡</strong>ï¼šé”™è¯¯ä¿¡æ¯åº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡</li><li><strong>åŒºåˆ†é”™è¯¯ç±»å‹</strong>ï¼šæ ¹æ®é”™è¯¯ç±»å‹é‡‡å–ä¸åŒå¤„ç†ç­–ç•¥</li><li><strong>è®°å½•è¯¦ç»†æ—¥å¿—</strong>ï¼šå†…éƒ¨è®°å½•è¯¦ç»†é”™è¯¯ï¼Œå¯¹å¤–è¿”å›é€‚å½“ä¿¡æ¯</li><li><strong>é¿å…é”™è¯¯å¿½ç•¥</strong>ï¼šé™¤éç¡®å®å¯ä»¥å¿½ç•¥ï¼Œå¦åˆ™éƒ½åº”è¯¥å¤„ç†</li></ol><p><strong>ç°ä»£å‘å±•</strong>ï¼š</p><ul><li>Go 1.13+ å¼•å…¥äº†é”™è¯¯åŒ…è£…å’Œæ£€æŸ¥çš„æ–°åŠŸèƒ½</li><li>errors.Is() å’Œ errors.As() æä¾›äº†æ›´å¥½çš„é”™è¯¯æ£€æŸ¥èƒ½åŠ›</li><li>fmt.Errorf() çš„ %w åŠ¨è¯æ”¯æŒé”™è¯¯åŒ…è£…</li></ul><p>è‰¯å¥½çš„é”™è¯¯å¤„ç†ä¸ä»…èƒ½æé«˜ç¨‹åºçš„å¥å£®æ€§ï¼Œè¿˜èƒ½å¤§å¤§æ”¹å–„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„é”™è¯¯å¤„ç†ç­–ç•¥ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang%E8%AF%AD%E6%B3%95/>Golangè¯­æ³•</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/stu/golang-stu-11/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸€ç¯‡ æ¥å£(interface)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-10/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åç¯‡ æ–¹æ³•(method)ä¸æ¥æ”¶è€…ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-09/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬ä¹ç¯‡ ç»“æ„ä½“(struct)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-08/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬å…«ç¯‡ æŒ‡é’ˆ(pointer)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-07/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬ä¸ƒç¯‡ é—­åŒ…&amp;type defer panic recoveräº†è§£&amp;timeåŒ…ã€‘</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=zg-dd/zg-dd.github.io data-repo-id=R_kgDOQwB7tw data-category=Announcements data-category-id=DIC_kwDOQwB7t84C0WGD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2026 å°å··çš„éšç¬”</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>