<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="网络通讯核心知识\r一、核心概念\r1. Socket\r是什么：进程间通信(IPC)的扩展机制\n用途：建立网络通信通道（TCP/UDP）\n流程：\n服务端：socket → bind → listen → accept 客户端：socket → connect → write/read → close\n注意事项：需处理字节序转换(htonl/ntohl) 2. TCP vs UDP\r特性 TCP UDP 连接方式 面向连接（三次握手） 无连接 可靠性 可靠传输（重传机制） 不可靠传输 数据形式 流式套接字 数据报套接字 适用场景 文件传输、网页浏览 实时视频、DNS查询 二、服务器模型\r1. 迭代服务器\r缺陷：单线程阻塞，无法并发处理请求\n"><title>网络通讯核心知识</title><link rel=canonical href=https://zg-dd.github.io/stu/socket/><link rel=stylesheet href=/scss/style.min.ff560f1cad7a040e336f2dd6880b9ee1ad344d6e3d8f5411e5a1aaa8b23bbdd0.css><meta property='og:title' content="网络通讯核心知识"><meta property='og:description' content="网络通讯核心知识\r一、核心概念\r1. Socket\r是什么：进程间通信(IPC)的扩展机制\n用途：建立网络通信通道（TCP/UDP）\n流程：\n服务端：socket → bind → listen → accept 客户端：socket → connect → write/read → close\n注意事项：需处理字节序转换(htonl/ntohl) 2. TCP vs UDP\r特性 TCP UDP 连接方式 面向连接（三次握手） 无连接 可靠性 可靠传输（重传机制） 不可靠传输 数据形式 流式套接字 数据报套接字 适用场景 文件传输、网页浏览 实时视频、DNS查询 二、服务器模型\r1. 迭代服务器\r缺陷：单线程阻塞，无法并发处理请求\n"><meta property='og:url' content='https://zg-dd.github.io/stu/socket/'><meta property='og:site_name' content='小巷的随笔'><meta property='og:type' content='article'><meta property='article:section' content='Stu'><meta property='article:tag' content='Socket'><meta property='article:tag' content='TCP/UDP'><meta property='article:tag' content='I/O模型'><meta property='article:published_time' content='2025-08-15T19:08:51+08:00'><meta property='article:modified_time' content='2025-08-15T19:08:51+08:00'><meta name=twitter:title content="网络通讯核心知识"><meta name=twitter:description content="网络通讯核心知识\r一、核心概念\r1. Socket\r是什么：进程间通信(IPC)的扩展机制\n用途：建立网络通信通道（TCP/UDP）\n流程：\n服务端：socket → bind → listen → accept 客户端：socket → connect → write/read → close\n注意事项：需处理字节序转换(htonl/ntohl) 2. TCP vs UDP\r特性 TCP UDP 连接方式 面向连接（三次握手） 无连接 可靠性 可靠传输（重传机制） 不可靠传输 数据形式 流式套接字 数据报套接字 适用场景 文件传输、网页浏览 实时视频、DNS查询 二、服务器模型\r1. 迭代服务器\r缺陷：单线程阻塞，无法并发处理请求\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_a0cc1cf57968b27d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🌱</span></figure><div class=site-meta><h1 class=site-name><a href=/>小巷的随笔</a></h1><h2 class=site-description>记录，不是为了证明自己；而是把“解决问题 → 思考 → 沉淀”形成习惯。</h2></div></header><ol class=menu id=main-menu><li class=current><a href=/stu/><span>学习笔记</span></a></li><li><a href=/blog/><span>随笔思考</span></a></li><li><a href=/life/><span>生活记录</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://zg-dd.github.io/ selected>简体中文</option><option value=https://zg-dd.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#一核心概念>一、核心概念</a><ul><li><a href=#1-socket>1. Socket</a></li><li><a href=#2-tcp-vs-udp>2. TCP vs UDP</a></li></ul></li><li><a href=#二服务器模型>二、服务器模型</a><ul><li><a href=#1-迭代服务器>1. 迭代服务器</a></li><li><a href=#2-进程线程模型>2. 进程/线程模型</a></li><li><a href=#3-进程池优化>3. 进程池优化</a></li></ul></li><li><a href=#三高性能io模型>三、高性能I/O模型</a><ul><li><a href=#1-传统阻塞模型>1. 传统阻塞模型</a></li><li><a href=#2-selectpoll>2. Select/Poll</a></li><li><a href=#3-epoll>3. Epoll</a></li><li><a href=#4-nionon-blocking-io>4. NIO（Non-blocking I/O）</a></li><li><a href=#5-aioasynchronous-io>5. AIO（Asynchronous I/O）</a></li><li><a href=#6-完整对比表>6. 完整对比表</a></li></ul></li><li><a href=#补充说明>补充说明</a></li><li><a href=#四实践要点>四、实践要点</a><ul><li><a href=#1-守护进程>1. 守护进程</a></li><li><a href=#2-udp服务器>2. UDP服务器</a></li><li><a href=#3-其他>3. 其他</a></li></ul></li><li><a href=#五学习建议>五、学习建议</a><ul><li><a href=#1-诊断工具>1. 诊断工具</a></li><li><a href=#2-经典书籍>2. 经典书籍</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/>计算机网络</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/stu/socket/>网络通讯核心知识</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-08-15T19:08:51+08:00>Aug 15, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 4 分钟</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://zg-dd.github.io/en/stu/socket/ class=link>English</a></div></footer></div></header><section class=article-content><h1 id=网络通讯核心知识>网络通讯核心知识</h1><h2 id=一核心概念>一、核心概念</h2><h3 id=1-socket>1. Socket</h3><p><strong>是什么</strong>：进程间通信(IPC)的扩展机制<br><strong>用途</strong>：建立网络通信通道（TCP/UDP）<br><strong>流程</strong>：</p><ul><li>服务端：socket → bind → listen → accept</li><li>客户端：socket → connect → write/read → close<br><strong>注意事项</strong>：需处理字节序转换(htonl/ntohl)</li></ul><h3 id=2-tcp-vs-udp>2. TCP vs UDP</h3><div class=table-wrapper><table><thead><tr><th>特性</th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td>连接方式</td><td>面向连接（三次握手）</td><td>无连接</td></tr><tr><td>可靠性</td><td>可靠传输（重传机制）</td><td>不可靠传输</td></tr><tr><td>数据形式</td><td>流式套接字</td><td>数据报套接字</td></tr><tr><td>适用场景</td><td>文件传输、网页浏览</td><td>实时视频、DNS查询</td></tr></tbody></table></div><h2 id=二服务器模型>二、服务器模型</h2><h3 id=1-迭代服务器>1. 迭代服务器</h3><p><strong>缺陷</strong>：单线程阻塞，无法并发处理请求</p><h3 id=2-进程线程模型>2. 进程/线程模型</h3><p><strong>进程方案</strong>：</p><ul><li>需用waitpid()避免僵尸进程</li><li>注意：子进程结束需父进程回收资源</li></ul><p><strong>僵尸进程处理详解</strong>：</p><ol><li><p><strong>产生原因</strong>：</p><ul><li>子进程终止但未被父进程wait()</li><li>会占用系统进程表资源</li></ul></li><li><p><strong>处理方法</strong>：</p><ul><li><strong>同步回收</strong>：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>waitpid</span>(pid, NULL, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// 阻塞等待
</span></span></span></code></pre></div></li><li><strong>异步回收</strong>（推荐）：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>signal</span>(SIGCHLD, [](<span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>waitpid</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, NULL, WNOHANG) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></li></ul></li><li><p><strong>特殊情形</strong>：</p><ul><li>父进程先终止时，僵尸进程由init进程接管并回收</li><li>批量回收时需循环调用waitpid()</li></ul></li></ol><p><strong>线程方案</strong>：</p><ul><li>需处理共享变量加锁问题</li><li>线程同步更复杂（临界区/锁机制）</li></ul><h3 id=3-进程池优化>3. 进程池优化</h3><div class=table-wrapper><table><thead><tr><th>类型</th><th>特点</th></tr></thead><tbody><tr><td>静态进程池</td><td>预创建进程，限制并发上限</td></tr><tr><td>动态进程池</td><td>维护最小/最大空闲进程数</td></tr></tbody></table></div><h2 id=三高性能io模型>三、高性能I/O模型</h2><h3 id=1-传统阻塞模型>1. 传统阻塞模型</h3><p><strong>特点</strong>：</p><ul><li>单线程阻塞等待I/O就绪</li><li>资源利用率低</li></ul><h3 id=2-selectpoll>2. Select/Poll</h3><div class=table-wrapper><table><thead><tr><th>特性</th><th>Select</th><th>Poll</th></tr></thead><tbody><tr><td>实现原理</td><td>位图轮询FD(描述符集)</td><td>链表轮询FD(描述符集)</td></tr><tr><td>最大连接数</td><td>1024（FD_SETSIZE限制）</td><td>无硬性限制</td></tr><tr><td>效率缺陷</td><td>O(n)线性扫描</td><td>O(n)线性扫描</td></tr><tr><td>跨平台性</td><td>所有平台支持</td><td>所有平台支持</td></tr></tbody></table></div><h3 id=3-epoll>3. Epoll</h3><p><strong>核心机制</strong>：</p><ol><li><strong>事件注册</strong>：通过epoll_ctl维护红黑树</li><li><strong>就绪列表</strong>：内核维护就绪FD双向链表</li><li><strong>触发模式</strong>：<ul><li>LT（Level Trigger）：类似Poll的触发方式</li><li>ET（Edge Trigger）：状态变化时单次通知</li></ul></li></ol><p><strong>性能优势</strong>：</p><ul><li>O(1)事件通知复杂度</li><li>百万级连接支持（C1000K场景）</li></ul><h3 id=4-nionon-blocking-io>4. NIO（Non-blocking I/O）</h3><p><strong>核心组件</strong>：</p><ol><li><strong>Channel</strong>：全双工通信管道（SocketChannel/FileChannel）</li><li><strong>Buffer</strong>：结构化数据容器（ByteBuffer/CharBuffer）</li><li><strong>Selector</strong>：多路复用器（基于系统epoll/kqueue实现）</li></ol><p><strong>工作流程</strong>：</p><pre tabindex=0><code class=language-plantuml data-lang=plantuml>start
: 创建Selector;
: 注册Channel到Selector;
repeat
  : select()查询就绪事件;
  : 处理SelectionKey事件;
repeat while (有事件?) 
stop
</code></pre><h3 id=5-aioasynchronous-io>5. AIO（Asynchronous I/O）</h3><p><strong>实现原理</strong>：</p><ul><li>内核完成I/O操作后主动回调</li><li>无需用户线程轮询</li></ul><p><strong>典型场景</strong>：</p><ul><li>大文件异步读写</li><li>高延迟网络操作</li></ul><h3 id=6-完整对比表>6. 完整对比表</h3><div class=table-wrapper><table><thead><tr><th>模型</th><th>阻塞性</th><th>线程要求</th><th>触发方式</th><th>适用场景</th></tr></thead><tbody><tr><td>阻塞I/O</td><td>完全阻塞</td><td>1:1</td><td>-</td><td>低并发简单场景</td></tr><tr><td>Select</td><td>非阻塞</td><td>1:N</td><td>轮询通知</td><td>跨平台中等并发</td></tr><tr><td>Poll</td><td>非阻塞</td><td>1:N</td><td>轮询通知</td><td>连接数&lt;10K</td></tr><tr><td>Epoll</td><td>非阻塞</td><td>1:N</td><td>事件驱动</td><td>Linux高并发系统</td></tr><tr><td>NIO</td><td>非阻塞</td><td>1:N</td><td>就绪选择</td><td>高吞吐应用</td></tr><tr><td>AIO</td><td>异步</td><td>0:1</td><td>完成回调</td><td>延迟敏感型操作</td></tr></tbody></table></div><h2 id=补充说明>补充说明</h2><ol><li><p><strong>内核支持</strong>：</p><ul><li>Windows：IOCP是真正的异步I/O</li><li>Linux：5.1+内核的io_uring接近真异步</li></ul></li><li><p><strong>性能临界点</strong>：</p><ul><li>C10K：Select/Poll达到性能瓶颈</li><li>C100K：必须使用Epoll/NIO</li><li>C1000K：需要Epoll+零拷贝优化</li></ul></li><li><p><strong>编程复杂度</strong>：</p><ul><li>阻塞I/O &lt; Select &lt; Poll &lt; Epoll &lt; NIO &lt; AIO</li></ul></li></ol><h2 id=四实践要点>四、实践要点</h2><h3 id=1-守护进程>1. 守护进程</h3><p><strong>关键步骤</strong>：</p><ol><li>fork()</li><li>setsid()<br><strong>需重定向</strong>标准I/O至/dev/null</li></ol><h3 id=2-udp服务器>2. UDP服务器</h3><p><strong>特点</strong>：</p><ul><li>无需listen()/accept()</li><li>直接使用recvfrom()/sendto()</li></ul><h3 id=3-其他>3. 其他</h3><ul><li><strong>Reuse Address</strong>：避免TIME_WAIT状态占用端口</li><li><strong>惊群效应</strong>：多进程Accept互相竞争导致，需内核锁优化<br><strong>服务器类型</strong>：</li><li>IO密集型：LNMP(nginx)</li><li>CPU密集型：LAMP(Apache)</li><li>协程：是用户态线程，用户态调度，避免内核切换开销，线程是内核调用。对比线程：切换速度更快，资源消耗更低</li></ul><h2 id=五学习建议>五、学习建议</h2><h3 id=1-诊断工具>1. 诊断工具</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>netstat -anp  <span style=color:#75715e># 查看网络连接</span>
</span></span></code></pre></div><h3 id=2-经典书籍>2. 经典书籍</h3><ul><li>《Unix网络编程》</li><li>《Unix环境高级编程》</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/socket/>Socket</a>
<a href=/tags/tcp/udp/>TCP/UDP</a>
<a href=/tags/i/o%E6%A8%A1%E5%9E%8B/>I/O模型</a></section></footer></article><script src=https://giscus.app/client.js data-repo=zg-dd/zg-dd.github.io data-repo-id=R_kgDOQwB7tw data-category=Announcements data-category-id=DIC_kwDOQwB7t84C0WGD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2026 小巷的随笔</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>