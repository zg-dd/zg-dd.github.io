<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" Byte Buddyæ˜¯javaçš„å­—èŠ‚ç å¢å¼ºå™¨ï¼Œä¸€ä¸ªä¼˜é›…çš„è¿è¡Œæ—¶javaä»£ç ç”Ÿæˆåº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ…é‡\næ–‡æ¡£åœ°å€ï¼šhttp://bytebuddy.net/#/tutorial-cn\n1. å¼•å…¥ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. ByteBuddyå­¦ä¹ \r2.1 ç±»çš„åˆ›å»º\rä»»ä½•ç±»çš„å®ä¾‹åˆ›å»ºéƒ½æ˜¯ä»ByteBuddyçš„å®ä¾‹å¼€å§‹\n"><title>Byte Buddyæ•™ç¨‹ï¼šJavaå­—èŠ‚ç å¢å¼ºä¸åŠ¨æ€ä»£ç ç”ŸæˆæŒ‡å—</title><link rel=canonical href=https://zg-dd.github.io/stu/byte-buddy-tutorial/><link rel=stylesheet href=/scss/style.min.ff560f1cad7a040e336f2dd6880b9ee1ad344d6e3d8f5411e5a1aaa8b23bbdd0.css><meta property='og:title' content="Byte Buddyæ•™ç¨‹ï¼šJavaå­—èŠ‚ç å¢å¼ºä¸åŠ¨æ€ä»£ç ç”ŸæˆæŒ‡å—"><meta property='og:description' content=" Byte Buddyæ˜¯javaçš„å­—èŠ‚ç å¢å¼ºå™¨ï¼Œä¸€ä¸ªä¼˜é›…çš„è¿è¡Œæ—¶javaä»£ç ç”Ÿæˆåº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ…é‡\næ–‡æ¡£åœ°å€ï¼šhttp://bytebuddy.net/#/tutorial-cn\n1. å¼•å…¥ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. ByteBuddyå­¦ä¹ \r2.1 ç±»çš„åˆ›å»º\rä»»ä½•ç±»çš„å®ä¾‹åˆ›å»ºéƒ½æ˜¯ä»ByteBuddyçš„å®ä¾‹å¼€å§‹\n"><meta property='og:url' content='https://zg-dd.github.io/stu/byte-buddy-tutorial/'><meta property='og:site_name' content='å°å··çš„éšç¬”'><meta property='og:type' content='article'><meta property='article:section' content='Stu'><meta property='article:tag' content='Byte Buddy'><meta property='article:tag' content='Javaå­—èŠ‚ç '><meta property='article:tag' content='åŠ¨æ€ä»£ç†'><meta property='article:published_time' content='2024-07-21T17:14:51+08:00'><meta property='article:modified_time' content='2024-07-21T17:14:51+08:00'><meta name=twitter:title content="Byte Buddyæ•™ç¨‹ï¼šJavaå­—èŠ‚ç å¢å¼ºä¸åŠ¨æ€ä»£ç ç”ŸæˆæŒ‡å—"><meta name=twitter:description content=" Byte Buddyæ˜¯javaçš„å­—èŠ‚ç å¢å¼ºå™¨ï¼Œä¸€ä¸ªä¼˜é›…çš„è¿è¡Œæ—¶javaä»£ç ç”Ÿæˆåº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ…é‡\næ–‡æ¡£åœ°å€ï¼šhttp://bytebuddy.net/#/tutorial-cn\n1. å¼•å…¥ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. ByteBuddyå­¦ä¹ \r2.1 ç±»çš„åˆ›å»º\rä»»ä½•ç±»çš„å®ä¾‹åˆ›å»ºéƒ½æ˜¯ä»ByteBuddyçš„å®ä¾‹å¼€å§‹\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_a0cc1cf57968b27d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸŒ±</span></figure><div class=site-meta><h1 class=site-name><a href=/>å°å··çš„éšç¬”</a></h1><h2 class=site-description>è®°å½•ï¼Œä¸æ˜¯ä¸ºäº†è¯æ˜è‡ªå·±ï¼›è€Œæ˜¯æŠŠâ€œè§£å†³é—®é¢˜ â†’ æ€è€ƒ â†’ æ²‰æ·€â€å½¢æˆä¹ æƒ¯ã€‚</h2></div></header><ol class=menu id=main-menu><li class=current><a href=/stu/><span>å­¦ä¹ ç¬”è®°</span></a></li><li><a href=/blog/><span>éšç¬”æ€è€ƒ</span></a></li><li><a href=/life/><span>ç”Ÿæ´»è®°å½•</span></a></li><li><a href=/categories/><span>åˆ†ç±»</span></a></li><li><a href=/tags/><span>æ ‡ç­¾</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://zg-dd.github.io/ selected>ç®€ä½“ä¸­æ–‡</option><option value=https://zg-dd.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#21-ç±»çš„åˆ›å»º>2.1 ç±»çš„åˆ›å»º</a></li><li><a href=#22-æŒ‡å®šç±»çš„åŒ…å>2.2 æŒ‡å®šç±»çš„åŒ…å</a></li><li><a href=#23-ç±»çš„ä¿å­˜>2.3 ç±»çš„ä¿å­˜</a></li><li><a href=#24-ç±»çš„æ³¨å…¥>2.4 ç±»çš„æ³¨å…¥</a></li><li><a href=#25-bytebuddyå¢å¼ºæ–¹å¼>2.5 ByteBuddyå¢å¼ºæ–¹å¼</a></li><li><a href=#26-ç±»çš„åŠ è½½ç­–ç•¥>2.6 ç±»çš„åŠ è½½ç­–ç•¥</a></li><li><a href=#27-è¿è¡Œæ—¶å®ä¾‹åŒ–>2.7 è¿è¡Œæ—¶å®ä¾‹åŒ–</a></li><li><a href=#28-å­—æ®µå’Œæ–¹æ³•çš„å£°æ˜>2.8 å­—æ®µå’Œæ–¹æ³•çš„å£°æ˜</a></li></ul><ul><li><a href=#210-elementmatchers-å…ƒç´ é€‰æ‹©å™¨>2.10 ElementMatchers å…ƒç´ é€‰æ‹©å™¨</a></li><li><a href=#211-methoddelegationæ–¹æ³•å§”æ‰˜>2.11 MethodDelegation(æ–¹æ³•å§”æ‰˜)</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/java/>Java
</a><a href=/categories/%E5%AD%97%E8%8A%82%E7%A0%81%E6%93%8D%E4%BD%9C/>å­—èŠ‚ç æ“ä½œ</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/stu/byte-buddy-tutorial/>Byte Buddyæ•™ç¨‹ï¼šJavaå­—èŠ‚ç å¢å¼ºä¸åŠ¨æ€ä»£ç ç”ŸæˆæŒ‡å—</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-07-21T17:14:51+08:00>Jul 21, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 7 åˆ†é’Ÿ</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://zg-dd.github.io/en/stu/byte-buddy-tutorial/ class=link>English</a></div></footer></div></header><section class=article-content><blockquote><p>Byte Buddyæ˜¯javaçš„å­—èŠ‚ç å¢å¼ºå™¨ï¼Œä¸€ä¸ªä¼˜é›…çš„è¿è¡Œæ—¶javaä»£ç ç”Ÿæˆåº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ…é‡</p></blockquote><p>æ–‡æ¡£åœ°å€ï¼š<a class=link href=http://bytebuddy.net/#/tutorial-cn target=_blank rel=noopener>http://bytebuddy.net/#/tutorial-cn</a></p><h1 id=1-å¼•å…¥bytebuddy>1. å¼•å…¥ByteBuddy</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#75715e>&lt;!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;groupId&gt;</span>net.bytebuddy<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;artifactId&gt;</span>byte-buddy<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;version&gt;</span>1.14.17<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h1 id=2-bytebuddyå­¦ä¹ >2. ByteBuddyå­¦ä¹ </h1><h2 id=21-ç±»çš„åˆ›å»º>2.1 ç±»çš„åˆ›å»º</h2><p>ä»»ä½•ç±»çš„å®ä¾‹åˆ›å»ºéƒ½æ˜¯ä»ByteBuddyçš„å®ä¾‹å¼€å§‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)<span style=color:#75715e>// å¢å¼ºæ–¹å¼ï¼šç›®æ ‡ç±»ç”Ÿæˆå­ç±»</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;example.Type&#34;</span>) <span style=color:#75715e>// è‡ªå®šä¹‰ç”Ÿæˆçš„ç±»åï¼šåŒ…å+ç±»å</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>();<span style=color:#75715e>// ç¼–è¯‘ç”Ÿæˆè¯¥ç±»</span>
</span></span></code></pre></div><h2 id=22-æŒ‡å®šç±»çš„åŒ…å>2.2 æŒ‡å®šç±»çš„åŒ…å</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> byteBuddy
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>new</span> NamingStrategy.<span style=color:#a6e22e>AbstractBase</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>               <span style=color:#66d9ef>protected</span> String <span style=color:#a6e22e>name</span>(TypeDescription superClass) {
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;example.&#34;</span> <span style=color:#f92672>+</span> superClass.<span style=color:#a6e22e>getSimpleName</span>(); <span style=color:#75715e>// å¯è‡ªå®šä¹‰åŒ…åå’Œç±»å‹</span>
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>           }) 
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span></code></pre></div><h2 id=23-ç±»çš„ä¿å­˜>2.3 ç±»çš„ä¿å­˜</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>dynamicType.<span style=color:#a6e22e>saveIn</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;æ–‡ä»¶è·¯å¾„&#34;</span>));<span style=color:#75715e>// å°†ç±»Classæ–‡ä»¶ä¿å­˜æ–‡ä»¶å¤¹</span>
</span></span></code></pre></div><h2 id=24-ç±»çš„æ³¨å…¥>2.4 ç±»çš„æ³¨å…¥</h2><p>å¯ä»¥å°†åŠ¨æ€çš„ç”Ÿæˆçš„ç±»æ³¨å…¥åˆ°æŒ‡å®šjaråŒ…ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>dynamicType.<span style=color:#a6e22e>inject</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;jar&#34;</span>));<span style=color:#75715e>// å°†ç±»Classæ–‡ä»¶æ³¨å…¥åˆ°jaråŒ…ä¸­</span>
</span></span></code></pre></div><h2 id=25-bytebuddyå¢å¼ºæ–¹å¼>2.5 ByteBuddyå¢å¼ºæ–¹å¼</h2><p>ByteBuddyå…±æœ‰ä¸‰ç§å¢å¼ºæ–¹å¼ï¼š</p><ul><li>subclassï¼šä¸ºç›®æ ‡ç±»ç”Ÿæˆå­ç±»è¿›è¡Œå¢å¼º</li><li>rebaseï¼šå½“å¯¹ç±»å‹å˜åŸºæ—¶ï¼ŒByte Buddy ä¼šä¿ç•™æ‰€æœ‰è¢«å˜åŸºç±»çš„æ–¹æ³•å®ç°ã€‚Byte Buddy ä¼šç”¨å…¼å®¹çš„ç­¾åå¤åˆ¶æ‰€æœ‰æ–¹æ³•çš„å®ç°ä¸ºä¸€ä¸ªç§æœ‰çš„é‡å‘½åè¿‡çš„æ–¹æ³•ï¼Œ è€Œä¸åƒç±»é‡å®šä¹‰æ—¶ä¸¢å¼ƒè¦†å†™çš„æ–¹æ³•ã€‚ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œä¸å­˜åœ¨æ–¹æ³•å®ç°çš„ä¸¢å¤±ï¼Œè€Œä¸”å˜åŸºçš„æ–¹æ³•å¯ä»¥é€šè¿‡è°ƒç”¨è¿™äº›é‡å‘½åçš„æ–¹æ³•ï¼ˆç›®å‰å¹¶æœªå‘ç°èµ·ä½œç”¨ï¼‰</li><li>redefineï¼šé‡æ–°å®šä¹‰æ–¹æ³•ï¼Œä¼šæ›¿æ¢å·²å­˜åœ¨çš„æ–¹æ³•å®ç°ã€‚</li></ul><h2 id=26-ç±»çš„åŠ è½½ç­–ç•¥>2.6 ç±»çš„åŠ è½½ç­–ç•¥</h2><p>ClassLoadingStrategy.Defaultå®šä¹‰äº†å†…ç½®ç­–ç•¥ï¼Œå¦‚æœä¸é€‰æ‹©ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é»˜è®¤æ¨å¯¼å‡ºä¸€ä¸ªç­–ç•¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>WRAPPER ç­–ç•¥<span style=color:#960050;background-color:#1e0010>ï¼š</span>
</span></span><span style=display:flex><span>	<span style=color:#ae81ff>1</span>. åˆ›å»ºä¸€ä¸ªæ–°çš„ ClassLoader æ¥åŠ è½½åŠ¨æ€ç”Ÿæˆçš„ç±»å‹<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span><span style=display:flex><span>	<span style=color:#ae81ff>2</span>. é€‚åˆå¤§å¤šæ•°æƒ…å†µ<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>è¿™æ ·ç”Ÿäº§çš„åŠ¨æ€ç±»ä¸ä¼šè¢«ApplicationClassLoaderåŠ è½½åˆ°<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>ä¸ä¼šå½±å“åˆ°é¡¹ç›®ä¸­å·²ç»å­˜åœ¨çš„ç±»<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span><span style=display:flex><span>WRAPPER_PERSISTENT<span style=color:#960050;background-color:#1e0010>ï¼š</span>è¯¥ç­–ç•¥ä¸WRAPPERç›¸åŒ<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>ä½†é€šè¿‡ClassLoader.getResourceAsStream<span style=color:#960050;background-color:#1e0010>ï¼ˆ</span>String<span style=color:#960050;background-color:#1e0010>ï¼‰</span>å…¬å¼€è¡¨ç¤ºç±»çš„å­—èŠ‚æ•°ç»„<span style=color:#960050;background-color:#1e0010>ã€‚</span>ä¸ºæ­¤<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>æ‰€æœ‰ç±»æ–‡ä»¶éƒ½åœ¨åŒ…è£…ç±»åŠ è½½å™¨ä¸­ä½œä¸ºå­—èŠ‚æ•°ç»„æŒä¹…åŒ–<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span><span style=display:flex><span>CHILD_FIRST<span style=color:#960050;background-color:#1e0010>ï¼š</span>åˆ›å»ºä¸€ä¸ªå­ç±»ä¼˜å…ˆåŠ è½½çš„ ClassLoader<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>å³æ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span><span style=display:flex><span>CHILD_FIRST_PERSISTENT<span style=color:#960050;background-color:#1e0010>ï¼š</span>è¯¥ç­–ç•¥ä¸CHILD_FIRSTç›¸åŒ<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>ä½†é€šè¿‡ClassLoader.getResourceAsStream<span style=color:#960050;background-color:#1e0010>ï¼ˆ</span>String<span style=color:#960050;background-color:#1e0010>ï¼‰</span>å…¬å¼€è¡¨ç¤ºç±»çš„å­—èŠ‚æ•°ç»„<span style=color:#960050;background-color:#1e0010>ã€‚</span>ä¸ºæ­¤<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>æ‰€æœ‰ç±»æ–‡ä»¶éƒ½åœ¨åŒ…è£…ç±»åŠ è½½å™¨ä¸­ä½œä¸ºå­—èŠ‚æ•°ç»„æŒä¹…åŒ–<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span><span style=display:flex><span>INJECTION ç­–ç•¥<span style=color:#960050;background-color:#1e0010>ï¼š</span>ä½¿ç”¨åå°„<span style=color:#960050;background-color:#1e0010>ï¼Œ</span>å°†åŠ¨æ€ç”Ÿæˆçš„ç±»å‹ç›´æ¥æ³¨å…¥åˆ°å½“å‰ ClassLoader ä¸­<span style=color:#960050;background-color:#1e0010>ã€‚</span>
</span></span></code></pre></div><h2 id=27-è¿è¡Œæ—¶å®ä¾‹åŒ–>2.7 è¿è¡Œæ—¶å®ä¾‹åŒ–</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)<span style=color:#75715e>// å¢å¼ºæ–¹å¼ï¼šç›®æ ‡ç±»ç”Ÿæˆå­ç±»</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;example.Type&#34;</span>) <span style=color:#75715e>// è‡ªå®šä¹‰ç”Ÿæˆçš„ç±»åï¼šåŒ…å+ç±»å</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>();<span style=color:#75715e>// ç¼–è¯‘ç”Ÿæˆè¯¥ç±»</span>
</span></span></code></pre></div><h2 id=28-å­—æ®µå’Œæ–¹æ³•çš„å£°æ˜>2.8 å­—æ®µå’Œæ–¹æ³•çš„å£°æ˜</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>           <span style=color:#75715e>// å¢å¼ºæ–¹å¼</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// ç±»å</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;subclass.Example&#34;</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// å®šä¹‰å­—æ®µï¼Œç±»å‹ã€å¯è§è¡Œ // å¤šä¸ªå¯ä½¿ç”¨|å¹¶åˆ—</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>defineField</span>(<span style=color:#e6db74>&#34;username&#34;</span>, String.<span style=color:#a6e22e>class</span>, Modifier.<span style=color:#a6e22e>PUBLIC</span> <span style=color:#f92672>|</span> Modifier.<span style=color:#a6e22e>STATIC</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// å®šä¹‰getæ–¹æ³•</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>defineMethod</span>(<span style=color:#e6db74>&#34;getUserName&#34;</span>, String.<span style=color:#a6e22e>class</span>, Modifier.<span style=color:#a6e22e>PUBLIC</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>intercept</span>(FieldAccessor.<span style=color:#a6e22e>ofField</span>(<span style=color:#e6db74>&#34;username&#34;</span>)) <span style=color:#75715e>// è·å–å±æ€§usernameçš„å€¼</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span></code></pre></div><h1 id=29-fixedvalueå›ºå®šå€¼>2.9 FixedValueå›ºå®šå€¼</h1><p>FixedValueå¯ä»¥å£°æ˜ä»»æ„å›ºå®šå€¼ï¼Œç”¨äºå¯¹å­—æ®µï¼Œæ–¹æ³•çš„å®šä¹‰ï¼Œå›ºå®šå€¼æœ€ç»ˆä¼šå†™å…¥<strong>ç±»çš„å¸¸é‡æ± </strong>ä¸­ã€‚</p><h2 id=210-elementmatchers-å…ƒç´ é€‰æ‹©å™¨>2.10 ElementMatchers å…ƒç´ é€‰æ‹©å™¨</h2><p>ElementMatchersåŒ…å«äº†å¤§é‡åŒ¹é…è§„åˆ™ï¼Œç”¨äºè¦†å†™åŸç±»ï¼Œå¸¸ç”¨çš„æœ‰ï¼š</p><ul><li>isDeclaredBy åŒ¹é…æŸä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•</li><li>named æŒ‡å®šæ–¹æ³•å</li><li>takesArguments æŒ‡å®šå‚æ•°ä¸ªæ•°</li></ul><p>å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>bar</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>(Object o) { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// æ„å»ºä¸€ä¸ªå®ç°ç±»</span>
</span></span><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>new</span> NamingStrategy.<span style=color:#a6e22e>AbstractBase</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>               <span style=color:#66d9ef>protected</span> String <span style=color:#a6e22e>name</span>(TypeDescription superClass) {
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;subclass.subclass&#34;</span> <span style=color:#f92672>+</span> superClass.<span style=color:#a6e22e>getSimpleName</span>();
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>           })
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Foo.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>isDeclaredBy</span>(Foo.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;One!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>named</span>(<span style=color:#e6db74>&#34;foo&#34;</span>)).<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;Two!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>named</span>(<span style=color:#e6db74>&#34;foo&#34;</span>).<span style=color:#a6e22e>and</span>(ElementMatchers.<span style=color:#a6e22e>takesArguments</span>(1)))
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;Three!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span><span style=display:flex><span> <span style=color:#75715e>// æœ€ç»ˆç”Ÿæˆçš„ç±»å¦‚ä¸‹</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>subclassFoo</span> <span style=color:#66d9ef>extends</span> Foo {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>(Object var1) {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Three!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>() {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Two!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>bar</span>() {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;One!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>subclassFoo</span>() {}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¯¥ç¤ºä¾‹ä¸­
bar()æ–¹æ³•ä»…è¢«ElementMatchers.isDeclaredBy(Foo.class)åŒ¹é…åˆ°ï¼Œæœ€ç»ˆè¦†å†™äº†One!
foo()æ–¹æ³•è¢«ElementMatchers.named(&ldquo;foo&rdquo;)å’ŒElementMatchers.named(&ldquo;foo&rdquo;).and(ElementMatchers.takesArguments(1))åŒ¹é…åˆ°ï¼Œè¦†å†™äº†Tow!
foo(Object var1)ç„¶åå†è¢«ElementMatchers.named(&ldquo;foo&rdquo;).and(ElementMatchers.takesArguments(1))åŒ¹é…ï¼Œå†æ¬¡è¦†å†™ï¼Œå¾—åˆ°Three!</p><h2 id=211-methoddelegationæ–¹æ³•å§”æ‰˜>2.11 MethodDelegation(æ–¹æ³•å§”æ‰˜)</h2><p>æ–¹æ³•å§”æ‰˜ç»™ï¼Œå®ƒå¯¹æ–¹æ³•è°ƒç”¨åšå‡ºååº”æ—¶æä¾›äº†æœ€å¤§ç¨‹åº¦çš„è‡ªç”±ã€‚Sourceä¸­çš„æ–¹æ³•å¯ä»¥å§”æ‰˜ç»™Targetæ–¹æ³•è°ƒç”¨(Sourceå’ŒTargetçš„æ–¹æ³•åå¯ä»¥ä¸ä¸€è‡´)ï¼›<strong>æ³¨ï¼šæ‰€æœ‰çš„å§”æ‰˜æ–¹æ³•å¿…é¡»æ˜¯staticå£°æ˜</strong> ç®€å•ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// å˜åŸºå¯¹è±¡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>hello</span>(String name) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.hello origin&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load orignï¼š&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// å§”æ‰˜ç±»</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>hello</span>(String name) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.hello &#34;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load  before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å‚æ•°å¢å¼º</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> Arrays.<span style=color:#a6e22e>asList</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: foo&#34;</span>, info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: bar&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// æµ‹è¯•æ–¹æ³•</span>
</span></span><span style=display:flex><span> MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemoryDatabase();
</span></span><span style=display:flex><span> loggingDatabase.<span style=color:#a6e22e>hello</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>);
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return valueï¼š&#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span><span style=display:flex><span> <span style=color:#75715e>// å°†MemoryDatabaseç±»çš„æŒ‡å®šæ–¹æ³•è¿›è¡Œå§”æ‰˜å˜åŸº</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>redefine</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>method</span>(named(<span style=color:#e6db74>&#34;hello&#34;</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>method</span>(named(<span style=color:#e6db74>&#34;load&#34;</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>(), ClassReloadingStrategy.<span style=color:#a6e22e>fromInstalledAgent</span>())<span style=color:#75715e>// ClassReloadingStrategy.fromInstalledAgent()è¡¨ç¤ºä½¿ç”¨ä»£ç†ä¿®æ”¹æºæ–¹æ³•</span>
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>getLoaded</span>();
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;å˜åŸºåã€‚ã€‚ã€‚&#34;</span>);
</span></span><span style=display:flex><span> loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemoryDatabase();
</span></span><span style=display:flex><span> loggingDatabase.<span style=color:#a6e22e>hello</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>);
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return valueï¼š&#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#75715e>// è¿è¡Œç»“æœ</span>
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>hello</span> origin
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> orign<span style=color:#960050;background-color:#1e0010>ï¼š</span>hello MemoryDatabase
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>return</span> value<span style=color:#960050;background-color:#1e0010>ï¼š</span><span style=color:#f92672>[</span>hello MemoryDatabase, hello MemoryDatabase<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>å˜åŸºå<span style=color:#960050;background-color:#1e0010>ã€‚ã€‚ã€‚</span>
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>hello</span> hello MemoryDatabase<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span>  before
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span> after
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>return</span> value<span style=color:#960050;background-color:#1e0010>ï¼š</span><span style=color:#f92672>[</span>hello MemoryDatabase: foo, hello MemoryDatabase: bar<span style=color:#f92672>]</span>
</span></span></code></pre></div><blockquote><p>ä¸Šé¢è¿™ä¸ªç®€å•ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•å§”æ‰˜å¯ä»¥å°†åŸæ¥çš„æ–¹æ³•ç›´æ¥æ›¿æ¢æ‰ï¼Œè¿›è¡Œå˜åŸºä¿®æ”¹ã€‚åœ¨è¿›è¡Œä¿®æ”¹æºç ä¸­èµ·åˆ°äº†é‡è¦ä½œç”¨ã€‚æ³¨ï¼šsubclassæ˜¯å¯¹çˆ¶ç±»çš„å¢å¼ºï¼Œä¸ä¼šå¯¹æºç±»é€ æˆå½±å“ï¼Œredefineå’Œrebaseæ˜¯éœ€è¦ä»£ç†æƒé™çš„ï¼Œéœ€è¦å†å¯åŠ¨ç±»åŠ è½½å‰æ·»åŠ VMå‚æ•°ï¼š-javaagent:è·¯å¾„åœ°å€\byte-buddy-agent-1.14.17.jarbyte-buddy-agentæŒ‡çš„æ˜¯ä»£ç jarï¼Œç½‘ä¸Šæœç´¢å³å¯ä¸‹è½½ã€‚ä¸‹é¢å°±ä¸€ä¸€å¼€å§‹å­¦ä¹ æ–¹æ³•å§”æ‰˜çš„å„ç§åœºæ™¯ï¼š</p></blockquote><ul><li><p>@SuperCall</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load orignï¼š&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>@SuperCall</span> Callable<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> zuper) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å‚æ•°å¢å¼º</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> call <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>call</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> call;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// æµ‹è¯•TEST:</span>
</span></span><span style=display:flex><span>MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>method</span>(isDeclaredBy(MemoryDatabase.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>getLoaded</span>().<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return valueï¼š&#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span></code></pre></div><p>ä¸Šé¢çš„ç¤ºä¾‹å°†MemoryDatabase.loadå§”æ‰˜ç»™äº†LoggerInterceptor.logï¼›@SuperCallå£°æ˜è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼ŒæŒ‡çš„å°±æ˜¯MemoryDatabase.loadã€‚å…¶ä¸­Callable&lt;List>è¡¨ç¤ºloadæ–¹æ³•çš„è¿”å›ç±»å‹ã€‚è¿™ç§æ–¹å¼å…¶å®å°±æ˜¯spring aopçš„å®ç°æ–¹å¼ã€‚</p></li><li><p>@Super</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load orignï¼š&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// infoè¡¨ç¤ºæ–¹æ³•å‚æ•°ï¼Œzuperæ³¨è§£@Superå£°æ˜ï¼Œè¡¨ç¤ºä»£ç†å¯¹è±¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(String info, <span style=color:#a6e22e>@Super</span> MemoryDatabase zuper) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å‚æ•°å¢å¼º</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> strings <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>load</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Interceptor&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> strings;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// æµ‹è¯•TEST:</span>
</span></span><span style=display:flex><span>MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>method</span>(isDeclaredBy(MemoryDatabase.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>getLoaded</span>().<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return valueï¼š&#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span></code></pre></div><p>@Superæ˜¯æ˜ç¡®æŒ‡å®šäº†ä»£ç†å®ä¾‹ã€‚è¿›è¡Œç²¾ç¡®åŒ–çš„å®ç°</p></li><li><p>@RuntimeType</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load orignï¼š&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(Integer info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load orignï¼š&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span><span style=color:#75715e>// @RuntimeTypeè¿è¡Œæ—¶æŒ‡å®šå…·ä½“å‚æ•°ç±»å‹</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>@RuntimeType</span> Object info, <span style=color:#a6e22e>@Super</span> MemoryDatabase zuper) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å‚æ•°å¢å¼º</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> strings <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>load</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Interceptor&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log :&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> strings;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>@RuntimeTypeè¿è¡Œæ—¶æŒ‡å®šå‚æ•°ï¼Œå¯ä»¥å®ç°æ–¹æ³•é‡è½½çš„æ•ˆæœ</p><ul><li>@Pipe</li></ul><blockquote><p>æŒç»­å­¦ä¹ æ›´æ–°ä¸­ã€‚ã€‚ã€‚</p></blockquote><p>å€Ÿé‰´æ–‡ç« ï¼š<a class=link href=https://blog.csdn.net/zhou920786312/article/details/130649115 target=_blank rel=noopener>https://blog.csdn.net/zhou920786312/article/details/130649115</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/byte-buddy/>Byte Buddy</a>
<a href=/tags/java%E5%AD%97%E8%8A%82%E7%A0%81/>Javaå­—èŠ‚ç </a>
<a href=/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/>åŠ¨æ€ä»£ç†</a></section></footer></article><script src=https://giscus.app/client.js data-repo=zg-dd/zg-dd.github.io data-repo-id=R_kgDOQwB7tw data-category=Announcements data-category-id=DIC_kwDOQwB7t84C0WGD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2026 å°å··çš„éšç¬”</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>