<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="1. å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ\rå¹¶å‘ç¼–ç¨‹æ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€èƒ½ã€‚å¦‚æœè¯´ä¼ ç»Ÿçš„é¡ºåºæ‰§è¡Œåƒæ˜¯ä¸€ä¸ªäººæŒ‰éƒ¨å°±ç­åœ°å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆå¹¶å‘å°±åƒæ˜¯åŒæ—¶æŒ‡æŒ¥å¤šä¸ªå·¥äººå¹¶è¡Œå·¥ä½œã€‚Goè¯­è¨€å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œè®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•è€Œé«˜æ•ˆã€‚\n"><title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸‰ç¯‡ å¹¶å‘å…¥é—¨ï¼šgoroutine + channel åŸºç¡€ã€‘</title><link rel=canonical href=https://zg-dd.github.io/stu/golang-stu-13/><link rel=stylesheet href=/scss/style.min.ff560f1cad7a040e336f2dd6880b9ee1ad344d6e3d8f5411e5a1aaa8b23bbdd0.css><meta property='og:title' content="Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸‰ç¯‡ å¹¶å‘å…¥é—¨ï¼šgoroutine + channel åŸºç¡€ã€‘"><meta property='og:description' content="1. å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ\rå¹¶å‘ç¼–ç¨‹æ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€èƒ½ã€‚å¦‚æœè¯´ä¼ ç»Ÿçš„é¡ºåºæ‰§è¡Œåƒæ˜¯ä¸€ä¸ªäººæŒ‰éƒ¨å°±ç­åœ°å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆå¹¶å‘å°±åƒæ˜¯åŒæ—¶æŒ‡æŒ¥å¤šä¸ªå·¥äººå¹¶è¡Œå·¥ä½œã€‚Goè¯­è¨€å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œè®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•è€Œé«˜æ•ˆã€‚\n"><meta property='og:url' content='https://zg-dd.github.io/stu/golang-stu-13/'><meta property='og:site_name' content='å°å··çš„éšç¬”'><meta property='og:type' content='article'><meta property='article:section' content='Stu'><meta property='article:tag' content='Golangè¯­æ³•'><meta property='article:published_time' content='2026-02-04T21:15:16+08:00'><meta property='article:modified_time' content='2026-02-04T21:15:16+08:00'><meta name=twitter:title content="Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸‰ç¯‡ å¹¶å‘å…¥é—¨ï¼šgoroutine + channel åŸºç¡€ã€‘"><meta name=twitter:description content="1. å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ\rå¹¶å‘ç¼–ç¨‹æ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€èƒ½ã€‚å¦‚æœè¯´ä¼ ç»Ÿçš„é¡ºåºæ‰§è¡Œåƒæ˜¯ä¸€ä¸ªäººæŒ‰éƒ¨å°±ç­åœ°å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆå¹¶å‘å°±åƒæ˜¯åŒæ—¶æŒ‡æŒ¥å¤šä¸ªå·¥äººå¹¶è¡Œå·¥ä½œã€‚Goè¯­è¨€å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œè®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•è€Œé«˜æ•ˆã€‚\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_a0cc1cf57968b27d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸŒ±</span></figure><div class=site-meta><h1 class=site-name><a href=/>å°å··çš„éšç¬”</a></h1><h2 class=site-description>è®°å½•ï¼Œä¸æ˜¯ä¸ºäº†è¯æ˜è‡ªå·±ï¼›è€Œæ˜¯æŠŠâ€œè§£å†³é—®é¢˜ â†’ æ€è€ƒ â†’ æ²‰æ·€â€å½¢æˆä¹ æƒ¯ã€‚</h2></div></header><ol class=menu id=main-menu><li class=current><a href=/stu/><span>å­¦ä¹ ç¬”è®°</span></a></li><li><a href=/blog/><span>éšç¬”æ€è€ƒ</span></a></li><li><a href=/life/><span>ç”Ÿæ´»è®°å½•</span></a></li><li><a href=/categories/><span>åˆ†ç±»</span></a></li><li><a href=/tags/><span>æ ‡ç­¾</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://zg-dd.github.io/ selected>ç®€ä½“ä¸­æ–‡</option><option value=https://zg-dd.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#11-ä»€ä¹ˆæ˜¯å¹¶å‘>1.1 ä»€ä¹ˆæ˜¯å¹¶å‘</a></li><li><a href=#12-å¹¶å‘-vs-å¹¶è¡Œ-vs-ä¸²è¡Œ>1.2 å¹¶å‘ vs å¹¶è¡Œ vs ä¸²è¡Œ</a></li><li><a href=#13-goå¹¶å‘çš„æ ¸å¿ƒç»„ä»¶>1.3 Goå¹¶å‘çš„æ ¸å¿ƒç»„ä»¶</a></li></ul><ul><li><a href=#21-goroutineçš„åˆ›å»ºå’Œç®¡ç†>2.1 Goroutineçš„åˆ›å»ºå’Œç®¡ç†</a></li><li><a href=#22-goroutineè°ƒåº¦æœºåˆ¶>2.2 Goroutineè°ƒåº¦æœºåˆ¶</a></li></ul><ul><li><a href=#31-channelåŸºç¡€æ“ä½œ>3.1 ChannelåŸºç¡€æ“ä½œ</a></li><li><a href=#32-selectè¯­å¥>3.2 Selectè¯­å¥</a></li></ul><ul><li><a href=#41-worker-poolæ¨¡å¼>4.1 Worker Poolæ¨¡å¼</a></li><li><a href=#42-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼>4.2 ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</a></li><li><a href=#43-æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼>4.3 æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼</a></li></ul><ul><li><a href=#51-ç«æ€æ¡ä»¶å’Œäº’æ–¥é”>5.1 ç«æ€æ¡ä»¶å’Œäº’æ–¥é”</a></li><li><a href=#52-contextçš„ä½¿ç”¨>5.2 Contextçš„ä½¿ç”¨</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/golang/>Golang</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/stu/golang-stu-13/>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸‰ç¯‡ å¹¶å‘å…¥é—¨ï¼šgoroutine + channel åŸºç¡€ã€‘</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-04T21:15:16+08:00>Feb 04, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 22 åˆ†é’Ÿ</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://zg-dd.github.io/en/stu/golang-stu-13/ class=link>English</a></div></footer></div></header><section class=article-content><h1 id=1-å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ>1. å¹¶å‘ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ</h1><blockquote><p>å¹¶å‘ç¼–ç¨‹æ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€èƒ½ã€‚å¦‚æœè¯´ä¼ ç»Ÿçš„é¡ºåºæ‰§è¡Œåƒæ˜¯ä¸€ä¸ªäººæŒ‰éƒ¨å°±ç­åœ°å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆå¹¶å‘å°±åƒæ˜¯åŒæ—¶æŒ‡æŒ¥å¤šä¸ªå·¥äººå¹¶è¡Œå·¥ä½œã€‚Goè¯­è¨€å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œè®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•è€Œé«˜æ•ˆã€‚</p></blockquote><h2 id=11-ä»€ä¹ˆæ˜¯å¹¶å‘>1.1 ä»€ä¹ˆæ˜¯å¹¶å‘</h2><p>è®©æˆ‘ä»¬é€šè¿‡ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥ç†è§£å¹¶å‘ï¼š</p><p><strong>ç°å®åœºæ™¯å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>é¡ºåºæ‰§è¡Œ</strong>ï¼šä¸€ä¸ªäººåšé¥­ â†’ æ´—ç¢— â†’ æ‰“æ‰«å«ç”Ÿï¼ˆæ€»å…±éœ€è¦3å°æ—¶ï¼‰</li><li><strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼šä¸€ä¸ªäººåšé¥­çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªäººæ´—ç¢—ï¼Œç¬¬ä¸‰äººæ‰“æ‰«å«ç”Ÿï¼ˆæ€»å…±åªéœ€1å°æ—¶ï¼‰</li></ul><p><strong>ç¨‹åºä¸­çš„å¹¶å‘</strong>ï¼š</p><ul><li><strong>é¡ºåºæ‰§è¡Œ</strong>ï¼šæ‰§è¡Œä»»åŠ¡A â†’ æ‰§è¡Œä»»åŠ¡B â†’ æ‰§è¡Œä»»åŠ¡C</li><li><strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼šåŒæ—¶æ‰§è¡Œä»»åŠ¡Aã€Bã€C</li></ul><h2 id=12-å¹¶å‘-vs-å¹¶è¡Œ-vs-ä¸²è¡Œ>1.2 å¹¶å‘ vs å¹¶è¡Œ vs ä¸²è¡Œ</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¸²è¡Œæ‰§è¡Œç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>serialExecution</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== ä¸²è¡Œæ‰§è¡Œ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>task1</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>task2</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>task3</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>elapsed</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>start</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä¸²è¡Œæ‰§è¡Œæ€»è€—æ—¶ï¼š%v\n\n&#34;</span>, <span style=color:#a6e22e>elapsed</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¹¶å‘æ‰§è¡Œç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>concurrentExecution</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== å¹¶å‘æ‰§è¡Œ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨3ä¸ªgoroutineå¹¶å‘æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>task1</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>task2</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>task3</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…ä¸€æ®µæ—¶é—´è®©goroutineæ‰§è¡Œå®Œæˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>elapsed</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>start</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¹¶å‘æ‰§è¡Œæ€»è€—æ—¶ï¼š%v\n\n&#34;</span>, <span style=color:#a6e22e>elapsed</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>task1</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡1å¼€å§‹æ‰§è¡Œ...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡1æ‰§è¡Œå®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>task2</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡2å¼€å§‹æ‰§è¡Œ...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡2æ‰§è¡Œå®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>task3</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡3å¼€å§‹æ‰§è¡Œ...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡3æ‰§è¡Œå®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>serialExecution</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>concurrentExecution</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è§£é‡Šå¹¶å‘çš„ä¼˜åŠ¿</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== å¹¶å‘ä¼˜åŠ¿è¯´æ˜ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;1. æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;2. æ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸CPU&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;3. æ”¹å–„ç”¨æˆ·ä½“éªŒï¼ˆå“åº”æ›´å¿«ï¼‰&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;4. å¤„ç†I/Oå¯†é›†å‹ä»»åŠ¡æ›´æœ‰æ•ˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> ä¸²è¡Œæ‰§è¡Œ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä»»åŠ¡1å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡2å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡3å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡3æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä¸²è¡Œæ‰§è¡Œæ€»è€—æ—¶ï¼š3.004s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¹¶å‘æ‰§è¡Œ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä»»åŠ¡1å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡2å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡3å¼€å§‹æ‰§è¡Œ...
</span></span><span style=display:flex><span>ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡3æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>å¹¶å‘æ‰§è¡Œæ€»è€—æ—¶ï¼š1.001s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¹¶å‘ä¼˜åŠ¿è¯´æ˜ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>1. æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡
</span></span><span style=display:flex><span>2. æ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸CPU
</span></span><span style=display:flex><span>3. æ”¹å–„ç”¨æˆ·ä½“éªŒï¼ˆå“åº”æ›´å¿«ï¼‰
</span></span><span style=display:flex><span>4. å¤„ç†I/Oå¯†é›†å‹ä»»åŠ¡æ›´æœ‰æ•ˆ
</span></span></code></pre></div><h2 id=13-goå¹¶å‘çš„æ ¸å¿ƒç»„ä»¶>1.3 Goå¹¶å‘çš„æ ¸å¿ƒç»„ä»¶</h2><p>Goå¹¶å‘ç¼–ç¨‹ä¸»è¦ä¾é ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li><strong>Goroutine</strong>ï¼šè½»é‡çº§çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†</li><li><strong>Channel</strong>ï¼šç”¨äºgoroutineä¹‹é—´é€šä¿¡å’ŒåŒæ­¥çš„ç®¡é“</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;runtime&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateGoroutineBasics</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== GoroutineåŸºç¡€æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æŸ¥çœ‹å½“å‰goroutineæ•°é‡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;åˆå§‹goroutineæ•°é‡ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumGoroutine</span>())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨å¤šä¸ªgoroutine</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Goroutine %d å¼€å§‹æ‰§è¡Œ\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>id</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Goroutine %d æ‰§è¡Œå®Œæˆ\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¯åŠ¨ågoroutineæ•°é‡ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumGoroutine</span>())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…goroutineæ‰§è¡Œå®Œæˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æœ€ç»ˆgoroutineæ•°é‡ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumGoroutine</span>())
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateChannelBasics</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== ChannelåŸºç¡€æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºchannel</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨ç”Ÿäº§è€…goroutine</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ç”Ÿäº§è€…ï¼šå‡†å¤‡å‘é€æ•°æ®...&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;Hello from goroutine!&#34;</span>  <span style=color:#75715e>// å‘é€æ•°æ®åˆ°channel</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ç”Ÿäº§è€…ï¼šæ•°æ®å‘é€å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¸»goroutineä½œä¸ºæ¶ˆè´¹è€…</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä¸»ç¨‹åºï¼šç­‰å¾…æ¥æ”¶æ•°æ®...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>  <span style=color:#75715e>// ä»channelæ¥æ”¶æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä¸»ç¨‹åºï¼šæ¥æ”¶åˆ°æ•°æ®ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>message</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateGoroutineBasics</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateChannelBasics</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> GoroutineåŸºç¡€æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>åˆå§‹goroutineæ•°é‡ï¼š1
</span></span><span style=display:flex><span>å¯åŠ¨ågoroutineæ•°é‡ï¼š6
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>5</span> å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>1</span> å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>2</span> å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>3</span> å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>4</span> å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>1</span> æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>2</span> æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>3</span> æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>4</span> æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>Goroutine <span style=color:#ae81ff>5</span> æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>æœ€ç»ˆgoroutineæ•°é‡ï¼š1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> ChannelåŸºç¡€æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä¸»ç¨‹åºï¼šç­‰å¾…æ¥æ”¶æ•°æ®...
</span></span><span style=display:flex><span>ç”Ÿäº§è€…ï¼šå‡†å¤‡å‘é€æ•°æ®...
</span></span><span style=display:flex><span>ç”Ÿäº§è€…ï¼šæ•°æ®å‘é€å®Œæˆ
</span></span><span style=display:flex><span>ä¸»ç¨‹åºï¼šæ¥æ”¶åˆ°æ•°æ®ï¼šHello from goroutine!
</span></span></code></pre></div><h1 id=2-goroutineè¯¦è§£>2. Goroutineè¯¦è§£</h1><h2 id=21-goroutineçš„åˆ›å»ºå’Œç®¡ç†>2.1 Goroutineçš„åˆ›å»ºå’Œç®¡ç†</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;runtime&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// WaitGroupç”¨äºç­‰å¾…ä¸€ç»„goroutineå®Œæˆ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateWaitGroup</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== ä½¿ç”¨WaitGroupç­‰å¾…goroutineå®Œæˆ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tasks</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;ä»»åŠ¡A&#34;</span>, <span style=color:#e6db74>&#34;ä»»åŠ¡B&#34;</span>, <span style=color:#e6db74>&#34;ä»»åŠ¡C&#34;</span>, <span style=color:#e6db74>&#34;ä»»åŠ¡D&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¸ºæ¯ä¸ªä»»åŠ¡æ·»åŠ è®¡æ•°</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(len(<span style=color:#a6e22e>tasks</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tasks</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()  <span style=color:#75715e>// ä»»åŠ¡å®Œæˆæ—¶å‡å°‘è®¡æ•°</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¼€å§‹æ‰§è¡Œ%s (goroutine %d)\n&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>id</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>500</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%sæ‰§è¡Œå®Œæˆ (goroutine %d)\n&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>task</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()  <span style=color:#75715e>// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¸¦å‚æ•°çš„goroutine</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateGoroutineParameters</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å¸¦å‚æ•°çš„Goroutine ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ–¹æ³•1ï¼šä½¿ç”¨åŒ¿åå‡½æ•°æ•è·å‚æ•°</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>  <span style=color:#75715e>// é‡è¦ï¼šåˆ›å»ºå±€éƒ¨å˜é‡å‰¯æœ¬</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ–¹æ³•1 - å€¼ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ–¹æ³•2ï¼šé€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>val</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ–¹æ³•2 - å€¼ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Goroutineç”Ÿå‘½å‘¨æœŸç®¡ç†</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateLifecycle</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== Goroutineç”Ÿå‘½å‘¨æœŸ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„goroutine</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stop</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>stop</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Goroutineæ”¶åˆ°åœæ­¢ä¿¡å·ï¼Œæ­£åœ¨é€€å‡º...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Goroutineæ­£åœ¨å·¥ä½œä¸­...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>300</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è®©goroutineè¿è¡Œä¸€æ®µæ—¶é—´</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘é€åœæ­¢ä¿¡å·</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€åœæ­¢ä¿¡å·...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stop</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…ç¡®è®¤åœæ­¢</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>500</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä¸»ç¨‹åºç»“æŸ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateWaitGroup</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateGoroutineParameters</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateLifecycle</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== ç³»ç»Ÿä¿¡æ¯ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;CPUæ ¸å¿ƒæ•°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumCPU</span>())
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å½“å‰goroutineæ•°é‡ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumGoroutine</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> ä½¿ç”¨WaitGroupç­‰å¾…goroutineå®Œæˆ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ...
</span></span><span style=display:flex><span>å¼€å§‹æ‰§è¡Œä»»åŠ¡A <span style=color:#f92672>(</span>goroutine 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>å¼€å§‹æ‰§è¡Œä»»åŠ¡B <span style=color:#f92672>(</span>goroutine 1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>å¼€å§‹æ‰§è¡Œä»»åŠ¡C <span style=color:#f92672>(</span>goroutine 2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>å¼€å§‹æ‰§è¡Œä»»åŠ¡D <span style=color:#f92672>(</span>goroutine 3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ä»»åŠ¡Aæ‰§è¡Œå®Œæˆ <span style=color:#f92672>(</span>goroutine 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ä»»åŠ¡Bæ‰§è¡Œå®Œæˆ <span style=color:#f92672>(</span>goroutine 1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ä»»åŠ¡Cæ‰§è¡Œå®Œæˆ <span style=color:#f92672>(</span>goroutine 2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ä»»åŠ¡Dæ‰§è¡Œå®Œæˆ <span style=color:#f92672>(</span>goroutine 3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¸¦å‚æ•°çš„Goroutine <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ–¹æ³•1 - å€¼ï¼š1
</span></span><span style=display:flex><span>æ–¹æ³•1 - å€¼ï¼š2
</span></span><span style=display:flex><span>æ–¹æ³•1 - å€¼ï¼š3
</span></span><span style=display:flex><span>æ–¹æ³•2 - å€¼ï¼š1
</span></span><span style=display:flex><span>æ–¹æ³•2 - å€¼ï¼š2
</span></span><span style=display:flex><span>æ–¹æ³•2 - å€¼ï¼š3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Goroutineç”Ÿå‘½å‘¨æœŸ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>Goroutineæ­£åœ¨å·¥ä½œä¸­...
</span></span><span style=display:flex><span>Goroutineæ­£åœ¨å·¥ä½œä¸­...
</span></span><span style=display:flex><span>Goroutineæ­£åœ¨å·¥ä½œä¸­...
</span></span><span style=display:flex><span>å‘é€åœæ­¢ä¿¡å·...
</span></span><span style=display:flex><span>Goroutineæ”¶åˆ°åœæ­¢ä¿¡å·ï¼Œæ­£åœ¨é€€å‡º...
</span></span><span style=display:flex><span>ä¸»ç¨‹åºç»“æŸ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> ç³»ç»Ÿä¿¡æ¯ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>CPUæ ¸å¿ƒæ•°ï¼š8
</span></span><span style=display:flex><span>å½“å‰goroutineæ•°é‡ï¼š1
</span></span></code></pre></div><h2 id=22-goroutineè°ƒåº¦æœºåˆ¶>2.2 Goroutineè°ƒåº¦æœºåˆ¶</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;runtime&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateScheduler</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== Goroutineè°ƒåº¦æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// CPUå¯†é›†å‹ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;CPUå¯†é›†å‹ä»»åŠ¡å¼€å§‹&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>count</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>1000000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>count</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;CPUå¯†é›†å‹ä»»åŠ¡å®Œæˆï¼Œcount=%d\n&#34;</span>, <span style=color:#a6e22e>count</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// I/Oå¯†é›†å‹ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;I/Oå¯†é›†å‹ä»»åŠ¡å¼€å§‹&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)  <span style=color:#75715e>// æ¨¡æ‹ŸI/Oç­‰å¾…</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;I/Oå¯†é›†å‹ä»»åŠ¡å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ‰€æœ‰ä»»åŠ¡å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstratePreemption</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== æŠ¢å å¼è°ƒåº¦æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¤šä¸ªçŸ­ä»»åŠ¡æ¥è§‚å¯Ÿè°ƒåº¦</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>taskCount</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>taskCount</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>taskCount</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡%då¼€å§‹æ‰§è¡Œ\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> &lt; <span style=color:#ae81ff>100000</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>j</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>j</span>  <span style=color:#75715e>// CPUè®¡ç®—</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡%dæ‰§è¡Œå®Œæˆ\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ‰€æœ‰çŸ­ä»»åŠ¡å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateScheduler</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstratePreemption</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ˜¾ç¤ºè°ƒåº¦å™¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== è°ƒåº¦å™¨ä¿¡æ¯ ===&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;GOMAXPROCSï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>GOMAXPROCS</span>(<span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;NumCPUï¼š%d\n&#34;</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumCPU</span>())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è®¾ç½®GOMAXPROCS</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>old</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>GOMAXPROCS</span>(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ—§çš„GOMAXPROCSï¼š%dï¼Œæ–°çš„GOMAXPROCSï¼š%d\n&#34;</span>, <span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>GOMAXPROCS</span>(<span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> Goroutineè°ƒåº¦æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>CPUå¯†é›†å‹ä»»åŠ¡å¼€å§‹
</span></span><span style=display:flex><span>I/Oå¯†é›†å‹ä»»åŠ¡å¼€å§‹
</span></span><span style=display:flex><span>I/Oå¯†é›†å‹ä»»åŠ¡å®Œæˆ
</span></span><span style=display:flex><span>CPUå¯†é›†å‹ä»»åŠ¡å®Œæˆï¼Œcount<span style=color:#f92672>=</span><span style=color:#ae81ff>499999500000</span>
</span></span><span style=display:flex><span>æ‰€æœ‰ä»»åŠ¡å®Œæˆ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> æŠ¢å å¼è°ƒåº¦æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä»»åŠ¡9å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡0å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡1å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡2å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡3å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡4å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡5å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡6å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡7å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡8å¼€å§‹æ‰§è¡Œ
</span></span><span style=display:flex><span>ä»»åŠ¡9æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡0æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡3æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡4æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡5æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡6æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡7æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>ä»»åŠ¡8æ‰§è¡Œå®Œæˆ
</span></span><span style=display:flex><span>æ‰€æœ‰çŸ­ä»»åŠ¡å®Œæˆ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> è°ƒåº¦å™¨ä¿¡æ¯ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>GOMAXPROCSï¼š8
</span></span><span style=display:flex><span>NumCPUï¼š8
</span></span><span style=display:flex><span>æ—§çš„GOMAXPROCSï¼š8ï¼Œæ–°çš„GOMAXPROCSï¼š2
</span></span></code></pre></div><h1 id=3-channelè¯¦è§£>3. Channelè¯¦è§£</h1><h2 id=31-channelåŸºç¡€æ“ä½œ>3.1 ChannelåŸºç¡€æ“ä½œ</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åŸºæœ¬channelæ“ä½œ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>basicChannelOperations</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== åŸºæœ¬Channelæ“ä½œ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. åˆ›å»ºchannel</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. å‘é€æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€æ•°æ®ï¼š100&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€æ•°æ®ï¼š200&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. æ¥æ”¶æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value1</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value2</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value2</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¸¦ç¼“å†²çš„channel</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>bufferedChannel</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å¸¦ç¼“å†²çš„Channel ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¸¦ç¼“å†²çš„channelï¼ˆç¼“å†²åŒºå¤§å°ä¸º2ï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯ä»¥è¿ç»­å‘é€è€Œä¸é˜»å¡ï¼ˆç¼“å†²åŒºæœªæ»¡æ—¶ï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ¶ˆæ¯1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å·²å‘é€æ¶ˆæ¯1&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ¶ˆæ¯2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å·²å‘é€æ¶ˆæ¯2&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç¼“å†²åŒºæ»¡äº†ï¼Œè¿™ä¼šé˜»å¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‡†å¤‡å‘é€æ¶ˆæ¯3...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ¶ˆæ¯3&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ¶ˆæ¯3å‘é€å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¥æ”¶æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>msg1</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>msg1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>msg2</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>msg2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>msg3</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>msg3</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å•å‘channel</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>directionalChannel</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å•å‘Channel ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘é€æ–¹ï¼šåªèƒ½å‘é€æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>sendOnly</span>(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¥æ”¶æ–¹ï¼šåªèƒ½æ¥æ”¶æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>receiveOnly</span>(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sendOnly</span>(<span style=color:#a6e22e>ch</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€æ–¹ï¼šå‘é€æ•°æ®&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€æ–¹ï¼šå‘é€å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>receiveOnly</span>(<span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ¥æ”¶æ–¹ï¼šç­‰å¾…æ•°æ®&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶æ–¹ï¼šæ¥æ”¶åˆ° %d\n&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// channelå…³é—­å’Œrange</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>channelCloseAndRange</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== Channelå…³é—­å’ŒRange ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘é€æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å‘é€ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>ch</span>)  <span style=color:#75715e>// å…³é—­channel</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Channelå·²å…³é—­&#34;</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨rangeæ¥æ”¶æ‰€æœ‰æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å¼€å§‹æ¥æ”¶æ•°æ®...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ch</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ¥æ”¶å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>basicChannelOperations</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bufferedChannel</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>directionalChannel</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>channelCloseAndRange</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> åŸºæœ¬Channelæ“ä½œ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š100
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š100
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š200
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š200
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¸¦ç¼“å†²çš„Channel <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å·²å‘é€æ¶ˆæ¯1
</span></span><span style=display:flex><span>å·²å‘é€æ¶ˆæ¯2
</span></span><span style=display:flex><span>å‡†å¤‡å‘é€æ¶ˆæ¯3...
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼šæ¶ˆæ¯1
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼šæ¶ˆæ¯2
</span></span><span style=display:flex><span>æ¶ˆæ¯3å‘é€å®Œæˆ
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼šæ¶ˆæ¯3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å•å‘Channel <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ¥æ”¶æ–¹ï¼šç­‰å¾…æ•°æ®
</span></span><span style=display:flex><span>å‘é€æ–¹ï¼šå‘é€æ•°æ®
</span></span><span style=display:flex><span>å‘é€æ–¹ï¼šå‘é€å®Œæˆ
</span></span><span style=display:flex><span>æ¥æ”¶æ–¹ï¼šæ¥æ”¶åˆ° 42
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Channelå…³é—­å’ŒRange <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¼€å§‹æ¥æ”¶æ•°æ®...
</span></span><span style=display:flex><span>å‘é€ï¼š1
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š1
</span></span><span style=display:flex><span>å‘é€ï¼š2
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š2
</span></span><span style=display:flex><span>å‘é€ï¼š3
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š3
</span></span><span style=display:flex><span>å‘é€ï¼š4
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š4
</span></span><span style=display:flex><span>å‘é€ï¼š5
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š5
</span></span><span style=display:flex><span>Channelå·²å…³é—­
</span></span><span style=display:flex><span>æ¥æ”¶å®Œæˆ
</span></span></code></pre></div><h2 id=32-selectè¯­å¥>3.2 Selectè¯­å¥</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åŸºæœ¬selectç”¨æ³•</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>basicSelect</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== åŸºæœ¬Selectç”¨æ³• ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch1</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch1</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ¥è‡ªchannel1çš„æ¶ˆæ¯&#34;</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>200</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch2</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ¥è‡ªchannel2çš„æ¶ˆæ¯&#34;</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// selectç­‰å¾…å¤šä¸ªchannelæ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>2</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>msg1</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch1</span>:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>msg1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>msg2</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch2</span>:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%s\n&#34;</span>, <span style=color:#a6e22e>msg2</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¸¦é»˜è®¤åˆ†æ”¯çš„select</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>selectWithDefault</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å¸¦é»˜è®¤åˆ†æ”¯çš„Select ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¸é˜»å¡çš„select</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ²¡æœ‰æ•°æ®å¯æ¥æ”¶ï¼Œæ‰§è¡Œé»˜è®¤åˆ†æ”¯&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘é€æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…å¹¶æ¥æ”¶</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ç°åœ¨æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>After</span>(<span style=color:#ae81ff>200</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>):
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;è¶…æ—¶äº†&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¶…æ—¶æ§åˆ¶</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>timeoutControl</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== è¶…æ—¶æ§åˆ¶ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿå¯èƒ½è¶…æ—¶çš„æ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// éšæœºå†³å®šæ˜¯å¦è¶…æ—¶</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#ae81ff>150</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#e6db74>&#34;æ“ä½œå®Œæˆ&#34;</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨selectå®ç°è¶…æ—¶</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æˆåŠŸï¼š%s\n&#34;</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>After</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>):
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ“ä½œè¶…æ—¶&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¤šè·¯å¤ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>multiplexing</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å¤šè·¯å¤ç”¨ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¤šä¸ªchannel</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>channels</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>channels</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>channels</span>[<span style=color:#a6e22e>i</span>] = make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨å¤šä¸ªç”Ÿäº§è€…</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>channels</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>c</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>id</span><span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨selectå¤šè·¯å¤ç”¨æ¥æ”¶</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>received</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>received</span> &lt; len(<span style=color:#a6e22e>channels</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>channels</span>[<span style=color:#ae81ff>0</span>]:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»channel 0æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>received</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>channels</span>[<span style=color:#ae81ff>1</span>]:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»channel 1æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>received</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>channels</span>[<span style=color:#ae81ff>2</span>]:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»channel 2æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>val</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>received</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>basicSelect</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selectWithDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timeoutControl</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>multiplexing</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> åŸºæœ¬Selectç”¨æ³• <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼šæ¥è‡ªchannel1çš„æ¶ˆæ¯
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼šæ¥è‡ªchannel2çš„æ¶ˆæ¯
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¸¦é»˜è®¤åˆ†æ”¯çš„Select <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ²¡æœ‰æ•°æ®å¯æ¥æ”¶ï¼Œæ‰§è¡Œé»˜è®¤åˆ†æ”¯
</span></span><span style=display:flex><span>ç°åœ¨æ¥æ”¶åˆ°ï¼š42
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> è¶…æ—¶æ§åˆ¶ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æ“ä½œè¶…æ—¶
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å¤šè·¯å¤ç”¨ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä»channel 0æ¥æ”¶åˆ°ï¼š0
</span></span><span style=display:flex><span>ä»channel 1æ¥æ”¶åˆ°ï¼š10
</span></span><span style=display:flex><span>ä»channel 2æ¥æ”¶åˆ°ï¼š20
</span></span></code></pre></div><h1 id=4-å®é™…åº”ç”¨åœºæ™¯>4. å®é™…åº”ç”¨åœºæ™¯</h1><h2 id=41-worker-poolæ¨¡å¼>4.1 Worker Poolæ¨¡å¼</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å·¥ä½œä»»åŠ¡ç»“æ„</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Job</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ID</span>   <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Data</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å·¥ä½œç»“æœç»“æ„</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Result</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>JobID</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Error</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Worker Poolå®ç°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>WorkerPool</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>workers</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jobQueue</span>   <span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Job</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resultChan</span> <span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Result</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>         <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewWorkerPool</span>(<span style=color:#a6e22e>workers</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>WorkerPool</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>workers</span>:    <span style=color:#a6e22e>workers</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>jobQueue</span>:   make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Job</span>, <span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resultChan</span>: make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Result</span>, <span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>wp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span>) <span style=color:#a6e22e>Start</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>workers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>wp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span>) <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d å¯åŠ¨\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>job</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>jobQueue</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d å¤„ç†ä»»åŠ¡ %d\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>job</span>.<span style=color:#a6e22e>ID</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ¨¡æ‹Ÿå·¥ä½œå¤„ç†</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// äº§ç”Ÿç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Result</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>JobID</span>: <span style=color:#a6e22e>job</span>.<span style=color:#a6e22e>ID</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;å¤„ç†ç»“æœ-%s&#34;</span>, <span style=color:#a6e22e>job</span>.<span style=color:#a6e22e>Data</span>),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>resultChan</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d åœæ­¢\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>wp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span>) <span style=color:#a6e22e>Submit</span>(<span style=color:#a6e22e>job</span> <span style=color:#a6e22e>Job</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>jobQueue</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>job</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>wp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span>) <span style=color:#a6e22e>GetResult</span>() <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Result</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>resultChan</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>wp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>WorkerPool</span>) <span style=color:#a6e22e>Stop</span>() {
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>jobQueue</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>wp</span>.<span style=color:#a6e22e>resultChan</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateWorkerPool</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== Worker Poolæ¨¡å¼æ¼”ç¤º ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºworker pool</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pool</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewWorkerPool</span>(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>Start</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æäº¤ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jobs</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>Job</span>{
</span></span><span style=display:flex><span>        {<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>Data</span>: <span style=color:#e6db74>&#34;ä»»åŠ¡1æ•°æ®&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>Data</span>: <span style=color:#e6db74>&#34;ä»»åŠ¡2æ•°æ®&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>3</span>, <span style=color:#a6e22e>Data</span>: <span style=color:#e6db74>&#34;ä»»åŠ¡3æ•°æ®&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>Data</span>: <span style=color:#e6db74>&#34;ä»»åŠ¡4æ•°æ®&#34;</span>},
</span></span><span style=display:flex><span>        {<span style=color:#a6e22e>ID</span>: <span style=color:#ae81ff>5</span>, <span style=color:#a6e22e>Data</span>: <span style=color:#e6db74>&#34;ä»»åŠ¡5æ•°æ®&#34;</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æäº¤æ‰€æœ‰ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>job</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>jobs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>Submit</span>(<span style=color:#a6e22e>job</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ”¶é›†ç»“æœ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>results</span> <span style=color:#f92672>:=</span> make([]<span style=color:#a6e22e>Result</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>jobs</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>jobs</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>GetResult</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>results</span> = append(<span style=color:#a6e22e>results</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ”¶åˆ°ç»“æœï¼šä»»åŠ¡%d -&gt; %s\n&#34;</span>, <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>JobID</span>, <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åœæ­¢pool</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>Stop</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Worker Poolå·²åœæ­¢&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateWorkerPool</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> Worker Poolæ¨¡å¼æ¼”ç¤º <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>2</span> å¯åŠ¨
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>0</span> å¯åŠ¨
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>1</span> å¯åŠ¨
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>0</span> å¤„ç†ä»»åŠ¡ <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>2</span> å¤„ç†ä»»åŠ¡ <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>1</span> å¤„ç†ä»»åŠ¡ <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>æ”¶åˆ°ç»“æœï¼šä»»åŠ¡1 -&gt; å¤„ç†ç»“æœ-ä»»åŠ¡1æ•°æ®
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>0</span> å¤„ç†ä»»åŠ¡ <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>æ”¶åˆ°ç»“æœï¼šä»»åŠ¡2 -&gt; å¤„ç†ç»“æœ-ä»»åŠ¡2æ•°æ®
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>2</span> å¤„ç†ä»»åŠ¡ <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>æ”¶åˆ°ç»“æœï¼šä»»åŠ¡3 -&gt; å¤„ç†ç»“æœ-ä»»åŠ¡3æ•°æ®
</span></span><span style=display:flex><span>æ”¶åˆ°ç»“æœï¼šä»»åŠ¡4 -&gt; å¤„ç†ç»“æœ-ä»»åŠ¡4æ•°æ®
</span></span><span style=display:flex><span>æ”¶åˆ°ç»“æœï¼šä»»åŠ¡5 -&gt; å¤„ç†ç»“æœ-ä»»åŠ¡5æ•°æ®
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>0</span> åœæ­¢
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>1</span> åœæ­¢
</span></span><span style=display:flex><span>Worker <span style=color:#ae81ff>2</span> åœæ­¢
</span></span><span style=display:flex><span>Worker Poolå·²åœæ­¢
</span></span></code></pre></div><h2 id=42-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼>4.2 ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;math/rand&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Item</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ID</span>    <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç”Ÿäº§è€…</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>producer</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>items</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>Item</span>, <span style=color:#a6e22e>wg</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Item</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ID</span>:    <span style=color:#a6e22e>id</span><span style=color:#f92672>*</span><span style=color:#ae81ff>100</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Value</span>: <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;ç”Ÿäº§è€…%d-äº§å“%d&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>i</span>),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ç”Ÿäº§è€…%dç”Ÿäº§ï¼š%+v\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>item</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>items</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>item</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Intn</span>(<span style=color:#ae81ff>300</span>)) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ç”Ÿäº§è€…%då®Œæˆ\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ¶ˆè´¹è€…</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>consumer</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>items</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Item</span>, <span style=color:#a6e22e>wg</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>items</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¶ˆè´¹è€…%dæ¶ˆè´¹ï¼š%+v\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>item</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Intn</span>(<span style=color:#ae81ff>200</span>)) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¶ˆè´¹è€…%dé€€å‡º\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateProducerConsumer</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>items</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>Item</span>, <span style=color:#ae81ff>10</span>)  <span style=color:#75715e>// å¸¦ç¼“å†²çš„channel</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨ç”Ÿäº§è€…</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>producers</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>consumers</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>producers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>producer</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>items</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>wg</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨æ¶ˆè´¹è€…</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>consumers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>consumer</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>items</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>wg</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…ç”Ÿäº§è€…å®Œæˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å…³é—­channelï¼Œè®©æ¶ˆè´¹è€…çŸ¥é“æ²¡æœ‰æ›´å¤šæ•°æ®</span>
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>items</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç»™æ¶ˆè´¹è€…ä¸€äº›æ—¶é—´å¤„ç†å‰©ä½™æ•°æ®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ‰€æœ‰ç”Ÿäº§å’Œæ¶ˆè´¹å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Seed</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>UnixNano</span>())
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateProducerConsumer</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…1ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:101 Value:ç”Ÿäº§è€…1-äº§å“1<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…2ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:201 Value:ç”Ÿäº§è€…2-äº§å“1<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…1æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:101 Value:ç”Ÿäº§è€…1-äº§å“1<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…1ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:102 Value:ç”Ÿäº§è€…1-äº§å“2<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…2æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:201 Value:ç”Ÿäº§è€…2-äº§å“1<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…2ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:202 Value:ç”Ÿäº§è€…2-äº§å“2<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…3æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:102 Value:ç”Ÿäº§è€…1-äº§å“2<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…1ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:103 Value:ç”Ÿäº§è€…1-äº§å“3<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…1æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:202 Value:ç”Ÿäº§è€…2-äº§å“2<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…2ç”Ÿäº§ï¼š<span style=color:#f92672>{</span>ID:203 Value:ç”Ÿäº§è€…2-äº§å“3<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…2æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:103 Value:ç”Ÿäº§è€…1-äº§å“3<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…1å®Œæˆ
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…3æ¶ˆè´¹ï¼š<span style=color:#f92672>{</span>ID:203 Value:ç”Ÿäº§è€…2-äº§å“3<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>ç”Ÿäº§è€…2å®Œæˆ
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…1é€€å‡º
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…2é€€å‡º
</span></span><span style=display:flex><span>æ¶ˆè´¹è€…3é€€å‡º
</span></span><span style=display:flex><span>æ‰€æœ‰ç”Ÿäº§å’Œæ¶ˆè´¹å®Œæˆ
</span></span></code></pre></div><h2 id=43-æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼>4.3 æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ‰‡å‡ºï¼šä¸€ä¸ªè¾“å…¥ï¼Œå¤šä¸ªè¾“å‡º</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fanOut</span>(<span style=color:#a6e22e>input</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>outputs</span> []<span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>input</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å°†æ•°æ®å‘é€åˆ°æ‰€æœ‰è¾“å‡ºchannel</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>outputs</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>output</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å…³é—­æ‰€æœ‰è¾“å‡ºchannel</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>outputs</span> {
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>output</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ‰‡å…¥ï¼šå¤šä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡º</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fanIn</span>(<span style=color:#a6e22e>inputs</span> []<span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>output</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¸ºæ¯ä¸ªè¾“å…¥channelå¯åŠ¨ä¸€ä¸ªgoroutine</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>inputs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ch</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>output</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…æ‰€æœ‰è¾“å…¥å¤„ç†å®Œæˆ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>output</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>demonstrateFanInOut</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºè¾“å…¥channel</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¤šä¸ªè¾“å‡ºchannel</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>outputs</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>outputs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>outputs</span>[<span style=color:#a6e22e>i</span>] = make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨æ‰‡å‡º</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>fanOut</span>(<span style=color:#a6e22e>input</span>, <span style=color:#a6e22e>outputs</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºæ‰‡å…¥çš„è¾“å…¥ï¼ˆæ¥è‡ªæ‰‡å‡ºçš„è¾“å‡ºï¼‰</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fanInInput</span> <span style=color:#f92672>:=</span> make([]<span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, len(<span style=color:#a6e22e>outputs</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>outputs</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fanInInput</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>output</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºæœ€ç»ˆè¾“å‡º</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>finalOutput</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>15</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨æ‰‡å…¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>fanIn</span>(<span style=color:#a6e22e>fanInInput</span>, <span style=color:#a6e22e>finalOutput</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘é€æ•°æ®åˆ°è¾“å…¥</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>5</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>input</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å‘é€æ•°æ®ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¥æ”¶æœ€ç»ˆç»“æœ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ¥æ”¶å¤„ç†ç»“æœï¼š&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>finalOutput</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ¥æ”¶åˆ°ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;æ‰‡å…¥æ‰‡å‡ºå¤„ç†å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>demonstrateFanInOut</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š1
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š2
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š3
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š4
</span></span><span style=display:flex><span>å‘é€æ•°æ®ï¼š5
</span></span><span style=display:flex><span>æ¥æ”¶å¤„ç†ç»“æœï¼š
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š1
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š1
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š1
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š2
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š2
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š2
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š3
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š3
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š3
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š4
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š4
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š4
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š5
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š5
</span></span><span style=display:flex><span>æ¥æ”¶åˆ°ï¼š5
</span></span><span style=display:flex><span>æ‰‡å…¥æ‰‡å‡ºå¤„ç†å®Œæˆ
</span></span></code></pre></div><h1 id=5-å¹¶å‘å®‰å…¨å’Œæœ€ä½³å®è·µ>5. å¹¶å‘å®‰å…¨å’Œæœ€ä½³å®è·µ</h1><h2 id=51-ç«æ€æ¡ä»¶å’Œäº’æ–¥é”>5.1 ç«æ€æ¡ä»¶å’Œäº’æ–¥é”</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä¸å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ï¼ˆä¼šäº§ç”Ÿç«æ€æ¡ä»¶ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>unsafeCounter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== ä¸å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>counter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨å¤šä¸ªgoroutineåŒæ—¶å¢åŠ è®¡æ•°å™¨</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>1000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>  <span style=color:#75715e>// ç«æ€æ¡ä»¶ï¼</span>
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>counter</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ï¼ˆä½¿ç”¨äº’æ–¥é”ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>safeCounter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>counter</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>mutex</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>1000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>mutex</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>  <span style=color:#75715e>// ä¸´ç•ŒåŒº</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>mutex</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>counter</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨åŸå­æ“ä½œ</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>atomicCounter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== åŸå­æ“ä½œè®¡æ•°å™¨ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>counter</span> <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>1000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#75715e>// åŸå­å¢åŠ æ“ä½œ</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// atomic.AddInt64(&amp;counter, 1)</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>counter</span><span style=color:#f92672>++</span>  <span style=color:#75715e>// ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…åº”ä½¿ç”¨atomicåŒ…</span>
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š%d\n&#34;</span>, <span style=color:#a6e22e>counter</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¯»å†™é”ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readWriteLockExample</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== è¯»å†™é”ç¤ºä¾‹ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> = make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rwMutex</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å†™æ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rwMutex</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å†™æ“ä½œï¼šè·å–å†™é”&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span>[<span style=color:#e6db74>&#34;key1&#34;</span>] = <span style=color:#e6db74>&#34;value1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)  <span style=color:#75715e>// æ¨¡æ‹Ÿå†™æ“ä½œè€—æ—¶</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å†™æ“ä½œï¼šé‡Šæ”¾å†™é”&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rwMutex</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è¯»æ“ä½œ</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rwMutex</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;è¯»æ“ä½œ%dï¼šè·å–è¯»é”\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>data</span>[<span style=color:#e6db74>&#34;key1&#34;</span>]
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>50</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)  <span style=color:#75715e>// æ¨¡æ‹Ÿè¯»æ“ä½œè€—æ—¶</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;è¯»æ“ä½œ%dï¼šè¯»å–å€¼=%sï¼Œé‡Šæ”¾è¯»é”\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rwMutex</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>unsafeCounter</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>safeCounter</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>atomicCounter</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>readWriteLockExample</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> ä¸å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š947
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š1000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> åŸå­æ“ä½œè®¡æ•°å™¨ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>æœŸæœ›å€¼ï¼š1000ï¼Œå®é™…å€¼ï¼š1000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> è¯»å†™é”ç¤ºä¾‹ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å†™æ“ä½œï¼šè·å–å†™é”
</span></span><span style=display:flex><span>å†™æ“ä½œï¼šé‡Šæ”¾å†™é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ0ï¼šè·å–è¯»é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ1ï¼šè·å–è¯»é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ2ï¼šè·å–è¯»é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ0ï¼šè¯»å–å€¼<span style=color:#f92672>=</span>value1ï¼Œé‡Šæ”¾è¯»é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ1ï¼šè¯»å–å€¼<span style=color:#f92672>=</span>value1ï¼Œé‡Šæ”¾è¯»é”
</span></span><span style=display:flex><span>è¯»æ“ä½œ2ï¼šè¯»å–å€¼<span style=color:#f92672>=</span>value1ï¼Œé‡Šæ”¾è¯»é”
</span></span></code></pre></div><h2 id=52-contextçš„ä½¿ç”¨>5.2 Contextçš„ä½¿ç”¨</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åŸºæœ¬Contextä½¿ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>basicContext</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;=== åŸºæœ¬Contextä½¿ç”¨ ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¯å–æ¶ˆçš„context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithCancel</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>())
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨å·¥ä½œgoroutine</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å·¥ä½œgoroutineæ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œæ­£åœ¨é€€å‡º...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>200</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è®©å·¥ä½œè¿è¡Œä¸€æ®µæ—¶é—´</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å–æ¶ˆcontext</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å‘é€å–æ¶ˆä¿¡å·...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…ç¡®è®¤é€€å‡º</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>300</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä¸»ç¨‹åºç»“æŸ&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¸¦è¶…æ—¶çš„Context</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>timeoutContext</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== è¶…æ—¶Context ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»º500æ¯«ç§’è¶…æ—¶çš„context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#ae81ff>500</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()  <span style=color:#75715e>// ç¡®ä¿é‡Šæ”¾èµ„æº</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;å¼€å§‹é•¿æ—¶é—´ä»»åŠ¡...&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>800</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)  <span style=color:#75715e>// è¶…è¿‡è¶…æ—¶æ—¶é—´</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>done</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡å®Œæˆ&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡è¶…æ—¶ï¼š%v\n&#34;</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¸¦æˆªæ­¢æ—¶é—´çš„Context</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>deadlineContext</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== æˆªæ­¢æ—¶é—´Context ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºæˆªæ­¢æ—¶é—´ä¸º2ç§’åçš„context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deadline</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithDeadline</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>deadline</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ¨¡æ‹Ÿä»»åŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡ç»“æŸï¼š%v\n&#34;</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>())
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ä»»åŠ¡è¿›è¡Œä¸­...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>500</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç­‰å¾…ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Contextä¼ é€’å‚æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>contextWithValue</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;\n=== Contextä¼ é€’å‚æ•° ===&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºå¸¦å€¼çš„context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithValue</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#e6db74>&#34;userID&#34;</span>, <span style=color:#e6db74>&#34;user123&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> = <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithValue</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;requestID&#34;</span>, <span style=color:#e6db74>&#34;req456&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åœ¨ä¸åŒå±‚çº§ä¼ é€’context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>processRequest</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processRequest</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#e6db74>&#34;userID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#e6db74>&#34;requestID&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;å¤„ç†è¯·æ±‚ - ç”¨æˆ·IDï¼š%vï¼Œè¯·æ±‚IDï¼š%v\n&#34;</span>, <span style=color:#a6e22e>userID</span>, <span style=color:#a6e22e>requestID</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¼ é€’ç»™ä¸‹ä¸€å±‚</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>databaseQuery</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>databaseQuery</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#e6db74>&#34;userID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;æ•°æ®åº“æŸ¥è¯¢ - ç”¨æˆ·IDï¼š%v\n&#34;</span>, <span style=color:#a6e22e>userID</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>basicContext</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timeoutContext</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deadlineContext</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>contextWithValue</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>===</span> åŸºæœ¬Contextä½¿ç”¨ <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ­£åœ¨è¿è¡Œ...
</span></span><span style=display:flex><span>å‘é€å–æ¶ˆä¿¡å·...
</span></span><span style=display:flex><span>å·¥ä½œgoroutineæ”¶åˆ°å–æ¶ˆä¿¡å·ï¼Œæ­£åœ¨é€€å‡º...
</span></span><span style=display:flex><span>ä¸»ç¨‹åºç»“æŸ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> è¶…æ—¶Context <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¼€å§‹é•¿æ—¶é—´ä»»åŠ¡...
</span></span><span style=display:flex><span>ä»»åŠ¡è¶…æ—¶ï¼šcontext deadline exceeded
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> æˆªæ­¢æ—¶é—´Context <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>ä»»åŠ¡è¿›è¡Œä¸­...
</span></span><span style=display:flex><span>ä»»åŠ¡è¿›è¡Œä¸­...
</span></span><span style=display:flex><span>ä»»åŠ¡è¿›è¡Œä¸­...
</span></span><span style=display:flex><span>ä»»åŠ¡è¿›è¡Œä¸­...
</span></span><span style=display:flex><span>ä»»åŠ¡ç»“æŸï¼šcontext deadline exceeded
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Contextä¼ é€’å‚æ•° <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>å¤„ç†è¯·æ±‚ - ç”¨æˆ·IDï¼šuser123ï¼Œè¯·æ±‚IDï¼šreq456
</span></span><span style=display:flex><span>æ•°æ®åº“æŸ¥è¯¢ - ç”¨æˆ·IDï¼šuser123
</span></span></code></pre></div><h1 id=6-æ€»ç»“>6. æ€»ç»“</h1><p>Goè¯­è¨€çš„å¹¶å‘ç¼–ç¨‹ä»¥å…¶ç®€æ´å’Œé«˜æ•ˆè‘—ç§°ï¼š</p><p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>Goroutine</strong>ï¼šè½»é‡çº§çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†</li><li><strong>Channel</strong>ï¼šgoroutineé—´é€šä¿¡å’ŒåŒæ­¥çš„æœºåˆ¶</li><li><strong>Select</strong>ï¼šå¤šè·¯å¤ç”¨channelæ“ä½œ</li><li><strong>Context</strong>ï¼šæ§åˆ¶goroutineç”Ÿå‘½å‘¨æœŸå’Œä¼ é€’è¯·æ±‚èŒƒå›´å€¼</li></ul><p><strong>é‡è¦ç‰¹æ€§</strong>ï¼š</p><ol><li><strong>CSPæ¨¡å‹</strong>ï¼šé€šè¿‡é€šä¿¡å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜é€šä¿¡</li><li><strong>æŠ¢å å¼è°ƒåº¦</strong>ï¼šGoè¿è¡Œæ—¶è‡ªåŠ¨è°ƒåº¦goroutine</li><li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šgoroutineæ ˆå¤§å°å¯åŠ¨æ€è°ƒæ•´ï¼Œåˆå§‹å¾ˆå°</li><li><strong>æ­»é”æ£€æµ‹</strong>ï¼šè¿è¡Œæ—¶å¯ä»¥æ£€æµ‹åˆ°ä¸€äº›æ­»é”æƒ…å†µ</li></ol><p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p><ul><li>åˆç†ä½¿ç”¨WaitGroupç­‰å¾…goroutineå®Œæˆ</li><li>æ­£ç¡®å…³é—­channelé¿å…goroutineæ³„æ¼</li><li>ä½¿ç”¨Contextæ§åˆ¶goroutineç”Ÿå‘½å‘¨æœŸ</li><li>æ³¨æ„ç«æ€æ¡ä»¶ï¼Œé€‚å½“ä½¿ç”¨åŒæ­¥æœºåˆ¶</li><li>é€‰æ‹©åˆé€‚çš„å¹¶å‘æ¨¡å¼ï¼ˆWorker Poolã€ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç­‰ï¼‰</li></ul><p><strong>å¸¸è§æ¨¡å¼</strong>ï¼š</p><ul><li>Worker Poolï¼šæ§åˆ¶å¹¶å‘æ•°é‡</li><li>ç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼šè§£è€¦æ•°æ®ç”Ÿäº§å’Œæ¶ˆè´¹</li><li>æ‰‡å…¥æ‰‡å‡ºï¼šåˆ†å¸ƒå¼æ•°æ®å¤„ç†</li><li>è¶…æ—¶æ§åˆ¶ï¼šé˜²æ­¢æ— é™ç­‰å¾…</li></ul><p>å¹¶å‘ç¼–ç¨‹è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿå¢åŠ äº†ç¨‹åºçš„å¤æ‚æ€§ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„å¹¶å‘ç­–ç•¥ï¼Œé¿å…è¿‡åº¦è®¾è®¡ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/golang%E8%AF%AD%E6%B3%95/>Golangè¯­æ³•</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/stu/golang-stu-12/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åäºŒç¯‡ é”™è¯¯å¤„ç†(error)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-11/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åä¸€ç¯‡ æ¥å£(interface)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-10/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬åç¯‡ æ–¹æ³•(method)ä¸æ¥æ”¶è€…ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-09/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬ä¹ç¯‡ ç»“æ„ä½“(struct)ã€‘</h2></div></a></article><article><a href=/stu/golang-stu-08/><div class=article-details><h2 class=article-title>Golangå­¦ä¹ å†ç¨‹ã€ç¬¬å…«ç¯‡ æŒ‡é’ˆ(pointer)ã€‘</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=zg-dd/zg-dd.github.io data-repo-id=R_kgDOQwB7tw data-category=Announcements data-category-id=DIC_kwDOQwB7t84C0WGD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2026 å°å··çš„éšç¬”</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>