<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Java on 小巷的随笔</title><link>https://zg-dd.github.io/categories/java/</link><description>Recent content in Java on 小巷的随笔</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 19 Feb 2025 21:48:01 +0800</lastBuildDate><atom:link href="https://zg-dd.github.io/categories/java/index.xml" rel="self" type="application/rss+xml"/><item><title>Java PO 日志 JSON 化工具</title><link>https://zg-dd.github.io/blog/java-pojo-log-json/</link><pubDate>Wed, 19 Feb 2025 21:48:01 +0800</pubDate><guid>https://zg-dd.github.io/blog/java-pojo-log-json/</guid><description>&lt;blockquote&gt;
&lt;p&gt;在Java项目中，PO（Plain Old Java Object）对象遍布各个角落，且常常伴随着大量的日志记录需求。传统的做法是通过toString方法直接打印这些对象，然而这种方式输出的日志信息往往不够结构化，给日志排查带来了诸多不便。为了提升日志的可读性和可维护性，我们引入了一款高效工具，该工具能够将项目中约90%的日常PO对象日志自动转换为结构化的JSON格式数据。这一转变极大地简化了系统运维人员的工作，使他们能够更迅速、更准确地定位和解决问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="1-解决的问题"&gt;1. 解决的问题
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;示例 1：简单对象&lt;/p&gt;
&lt;p&gt;输入：&lt;code&gt;User(id=1, name=&amp;quot;Alice&amp;quot;, age=25)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;输出：&lt;code&gt;{&amp;quot;User&amp;quot;: {&amp;quot;id&amp;quot;: 1, &amp;quot;name&amp;quot;: &amp;quot;Alice&amp;quot;, &amp;quot;age&amp;quot;: 25}}&lt;/code&gt;
&lt;figure&gt;&lt;img src="https://zg-dd.github.io/img/jplj/jplj1.png"&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;示例 2：嵌套对象&lt;/p&gt;
&lt;p&gt;输入：&lt;code&gt;Order(id=1001, items=[Item(id=2001, name=&amp;quot;Book&amp;quot;)])&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;输出：&lt;code&gt;{&amp;quot;Order&amp;quot;: {&amp;quot;id&amp;quot;: 1001, &amp;quot;items&amp;quot;: [{&amp;quot;Item&amp;quot;: {&amp;quot;id&amp;quot;: 2001, &amp;quot;name&amp;quot;: &amp;quot;Book&amp;quot;}}]}}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src="https://zg-dd.github.io/img/jplj/jplj2.png"&gt;
&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;示例 3：复杂 Map&lt;/p&gt;
&lt;p&gt;输入：&lt;code&gt;Config(settings={key1=&amp;quot;value1&amp;quot;, key2=[1, 2, 3]})&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;输出：&lt;code&gt;{&amp;quot;Config&amp;quot;: {&amp;quot;settings&amp;quot;: {&amp;quot;key1&amp;quot;: &amp;quot;value1&amp;quot;, &amp;quot;key2&amp;quot;: [1, 2, 3]}}}&lt;/code&gt;
&lt;figure&gt;&lt;img src="https://zg-dd.github.io/img/jplj/jplj3.png"&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;示例4：自定义复杂对象&lt;/p&gt;
&lt;p&gt;输入：&lt;code&gt;User(username=张三, password=123456, students=[Student(name=李四, age=18, score=0.0, courses=null), Student(name=王五, age=20, score=0.0, courses=[数学, 英语, 物理])], map={aa=123, bb=456, cc=你好})&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;输出：&lt;code&gt;{
&amp;quot;User&amp;quot;: {
&amp;quot;username&amp;quot;: &amp;quot;张三&amp;quot;,
&amp;quot;password&amp;quot;: 123456,
&amp;quot;students&amp;quot;: [
{
&amp;quot;Student&amp;quot;: {
&amp;quot;name&amp;quot;: &amp;quot;李四&amp;quot;,
&amp;quot;age&amp;quot;: 18,
&amp;quot;score&amp;quot;: 0.0,
&amp;quot;courses&amp;quot;: null
}
},
{
&amp;quot;Student&amp;quot;: {
&amp;quot;name&amp;quot;: &amp;quot;王五&amp;quot;,
&amp;quot;age&amp;quot;: 20,
&amp;quot;score&amp;quot;: 0.0,
&amp;quot;courses&amp;quot;: [
&amp;quot;数学&amp;quot;,
&amp;quot;英语&amp;quot;,
&amp;quot;物理&amp;quot;
]
}
}
],
&amp;quot;map&amp;quot;: {
&amp;quot;aa&amp;quot;: 123,
&amp;quot;bb&amp;quot;: 456,
&amp;quot;cc&amp;quot;: &amp;quot;你好&amp;quot;
}
}
}&lt;/code&gt;
&lt;figure&gt;&lt;img src="https://zg-dd.github.io/img/jplj/jplj4.png"&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="2-下载地址"&gt;2. 下载地址
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://zg-dd.github.io/files/obj_cv_json.exe" &gt;下载脚本&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Java 高CPU线程排查脚本</title><link>https://zg-dd.github.io/blog/java-high-cpu-threads/</link><pubDate>Tue, 10 Sep 2024 13:48:55 +0800</pubDate><guid>https://zg-dd.github.io/blog/java-high-cpu-threads/</guid><description>&lt;p&gt;show-busy-java-threads.sh&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-powershell" data-lang="powershell"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#!/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# @Function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Find out the highest cpu consumed threads of java, and print the stack of these threads.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# @Usage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# $ ./show-busy-java-threads.sh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# @author Jerry Lee&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# java目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;JAVA_HOME=/usr/local/java/jdk1.8.0_202
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;readonly PROG=`basename $0`
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;readonly -a COMMAND_LINE=(&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$0&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;usage() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; cat &amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Usage&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt; ${PROG} [&lt;span style="color:#66d9ef"&gt;OPTION&lt;/span&gt;]...
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Find out the highest cpu consumed threads of java, and print the stack of these threads.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Example&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt; ${PROG} -c &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Options&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -p, --pid find out the highest cpu consumed threads from the specifed java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;default&lt;/span&gt; from all java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -c, --count set the thread count to show, &lt;span style="color:#66d9ef"&gt;default&lt;/span&gt; is &lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -h, --help display this help and exit
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;exit $1
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;readonly ARGS=`getopt -n &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$PROG&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; -a -o c:p:h -l count&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;,pid&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;,help -- &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;`
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;[ $? &lt;span style="color:#f92672"&gt;-ne&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt; ] &amp;amp;&amp;amp; usage &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;eval set -- &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;${ARGS}&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;while&lt;/span&gt; true; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;case &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$1&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;in&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -c|--count)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; count=&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$2&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;shift &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -p|--pid)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pid=&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$2&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;shift &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -h|--help)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; usage
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;shift
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;esac
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;done
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;count=${count&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;-5&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;redEcho() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; [ -c /dev/stdout ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# if stdout is console, turn on color output.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#f92672"&gt;-ne&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;\033[1;31m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -n &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -e &lt;span style="color:#e6db74"&gt;&amp;#34;\033[0m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } || echo &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;yellowEcho() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; [ -c /dev/stdout ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# if stdout is console, turn on color output.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#f92672"&gt;-ne&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;\033[1;33m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -n &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -e &lt;span style="color:#e6db74"&gt;&amp;#34;\033[0m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } || echo &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;blueEcho() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; [ -c /dev/stdout ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# if stdout is console, turn on color output.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#f92672"&gt;-ne&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;\033[1;36m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -n &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo -e &lt;span style="color:#e6db74"&gt;&amp;#34;\033[0m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } || echo &lt;span style="color:#e6db74"&gt;&amp;#34;$@&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Check the existence of jstack command!&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; ! which jstack &amp;amp;&amp;gt; /dev/null; then
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; [ -z &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; redEcho &lt;span style="color:#e6db74"&gt;&amp;#34;Error: jstack not found on PATH!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;exit &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ! [ &lt;span style="color:#f92672"&gt;-f&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;/bin/jstack&amp;#34;&lt;/span&gt; ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; redEcho &lt;span style="color:#e6db74"&gt;&amp;#34;Error: jstack not found on PATH and &lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;/bin/jstack file does NOT exists!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;exit &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ! [ -x &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;/bin/jstack&amp;#34;&lt;/span&gt; ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; redEcho &lt;span style="color:#e6db74"&gt;&amp;#34;Error: jstack not found on PATH and &lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;/bin/jstack is NOT executalbe!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;exit &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;export PATH=&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$JAVA_HOME&lt;span style="color:#e6db74"&gt;/bin:&lt;/span&gt;$PATH&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;fi
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;readonly uuid=`date +&lt;span style="color:#66d9ef"&gt;%&lt;/span&gt;s`_${RANDOM}_$$
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cleanupWhenExit() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rm /tmp/${uuid}_* &amp;amp;&amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;trap&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;cleanupWhenExit&amp;#34;&lt;/span&gt; EXIT
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;printStackOfThreads() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;local line
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;local count=&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;while&lt;/span&gt; IFS=&lt;span style="color:#e6db74"&gt;&amp;#34; &amp;#34;&lt;/span&gt; read -a line ; &lt;span style="color:#66d9ef"&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;local pid=${line[&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;]}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;local threadId=${line[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;local threadId0x=&lt;span style="color:#e6db74"&gt;&amp;#34;0x`printf %x &lt;/span&gt;${threadId}&lt;span style="color:#ae81ff"&gt;`&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;local user=${line[2]}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;local pcpu=${line[4]}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;local jstackFile=/tmp/&lt;/span&gt;${uuid}&lt;span style="color:#e6db74"&gt;_&lt;/span&gt;${pid}&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ ! -f &amp;#34;&lt;/span&gt;${jstackFile}&lt;span style="color:#e6db74"&gt;&amp;#34; ] &amp;amp;&amp;amp; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;if [ &amp;#34;&lt;/span&gt;${user}&lt;span style="color:#e6db74"&gt;&amp;#34; == &amp;#34;&lt;/span&gt;${USER}&lt;span style="color:#e6db74"&gt;&amp;#34; ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; jstack &lt;/span&gt;${pid}&lt;span style="color:#e6db74"&gt; &amp;gt; &lt;/span&gt;${jstackFile}&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;if [ &lt;/span&gt;$UID&lt;span style="color:#e6db74"&gt; == 0 ]; then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sudo -u &lt;/span&gt;${user}&lt;span style="color:#e6db74"&gt; jstack &lt;/span&gt;${pid}&lt;span style="color:#e6db74"&gt; &amp;gt; &lt;/span&gt;${jstackFile}&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; redEcho &amp;#34;&lt;/span&gt;[$((count++))] Fail to jstack Busy(${pcpu}%) thread(${threadId}/${threadId0x}) stack of java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;(${pid}) under user(${user}).&lt;span style="color:#e6db74"&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; redEcho &amp;#34;&lt;/span&gt;User of java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;($user) is not current user($USER), need sudo to run again&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; yellowEcho &amp;#34;&lt;/span&gt; sudo ${COMMAND_LINE[@]}&lt;span style="color:#e6db74"&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;echo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;continue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;fi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; } || {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; redEcho &amp;#34;&lt;/span&gt;[$((count++))] Fail to jstack Busy(${pcpu}%) thread(${threadId}/${threadId0x}) stack of java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;(${pid}) under user(${user}).&lt;span style="color:#e6db74"&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;echo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; rm &lt;/span&gt;${jstackFile}&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;continue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; blueEcho &amp;#34;&lt;/span&gt;[$((count++))] Busy(${pcpu}%) thread(${threadId}/${threadId0x}) stack of java &lt;span style="color:#66d9ef"&gt;process&lt;/span&gt;(${pid}) under user(${user})&lt;span style="color:#960050;background-color:#1e0010"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; sed &amp;#34;&lt;/span&gt;/nid=${threadId0x} /,/^$/p&lt;span style="color:#e6db74"&gt;&amp;#34; -n &lt;/span&gt;${jstackFile}&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;ps -Leo pid,lwp,user,comm,pcpu --no-headers | {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; [ -z &amp;#34;&lt;/span&gt;${pid}&lt;span style="color:#e6db74"&gt;&amp;#34; ] &amp;amp;&amp;amp;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; awk &amp;#39;&lt;/span&gt;$4&lt;span style="color:#e6db74"&gt;==&amp;#34;&lt;/span&gt;java&lt;span style="color:#e6db74"&gt;&amp;#34;{print &lt;/span&gt;$0&lt;span style="color:#e6db74"&gt;}&amp;#39; ||
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; awk -v &amp;#34;&lt;/span&gt;pid=${pid}&lt;span style="color:#e6db74"&gt;&amp;#34; &amp;#39;&lt;/span&gt;$1&lt;span style="color:#e6db74"&gt;==pid,&lt;/span&gt;$4&lt;span style="color:#e6db74"&gt;==&amp;#34;&lt;/span&gt;java&lt;span style="color:#e6db74"&gt;&amp;#34;{print &lt;/span&gt;$0&lt;span style="color:#e6db74"&gt;}&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt;} | sort -k5 -r -n | head --lines &amp;#34;&lt;/span&gt;${count}&lt;span style="color:#e6db74"&gt;&amp;#34; | printStackOfThreads
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item></channel></rss>