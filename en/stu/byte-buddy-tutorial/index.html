<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=' Byte Buddy is a bytecode enhancer for Java, an elegant runtime Java code generation library that should be used with caution.\nDocumentation: http://bytebuddy.net/#/tutorial\n1. Introducing ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. Learning ByteBuddy\r2.1 Class Creation\rAny instance creation starts with an instance of ByteBuddy.\nDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() .subclass(Object.class) // Enhancement method: Generate subclass of target class .name("example.Type") // Custom generated class name: package name + class name .make(); // Compile and generate the class 2.2 Specifying Package Name for Class\rDynamicType.Unloaded<?> dynamicType = byteBuddy .with(new NamingStrategy.AbstractBase() { @Override protected String name(TypeDescription superClass) { return "example." + superClass.getSimpleName(); // Customizable package name and type } }) .subclass(Object.class) .make(); 2.3 Saving Classes\rDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() dynamicType.saveIn(new File("file path")); // Save the class file to folder 2.4 Injecting Classes\rDynamically generated classes can be injected into a specified jar file.\n'><title>Byte Buddy Tutorial: Java Bytecode Enhancement and Dynamic Code Generation Guide</title><link rel=canonical href=https://zg-dd.github.io/en/stu/byte-buddy-tutorial/><link rel=stylesheet href=/scss/style.min.ff560f1cad7a040e336f2dd6880b9ee1ad344d6e3d8f5411e5a1aaa8b23bbdd0.css><meta property='og:title' content="Byte Buddy Tutorial: Java Bytecode Enhancement and Dynamic Code Generation Guide"><meta property='og:description' content=' Byte Buddy is a bytecode enhancer for Java, an elegant runtime Java code generation library that should be used with caution.\nDocumentation: http://bytebuddy.net/#/tutorial\n1. Introducing ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. Learning ByteBuddy\r2.1 Class Creation\rAny instance creation starts with an instance of ByteBuddy.\nDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() .subclass(Object.class) // Enhancement method: Generate subclass of target class .name("example.Type") // Custom generated class name: package name + class name .make(); // Compile and generate the class 2.2 Specifying Package Name for Class\rDynamicType.Unloaded<?> dynamicType = byteBuddy .with(new NamingStrategy.AbstractBase() { @Override protected String name(TypeDescription superClass) { return "example." + superClass.getSimpleName(); // Customizable package name and type } }) .subclass(Object.class) .make(); 2.3 Saving Classes\rDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() dynamicType.saveIn(new File("file path")); // Save the class file to folder 2.4 Injecting Classes\rDynamically generated classes can be injected into a specified jar file.\n'><meta property='og:url' content='https://zg-dd.github.io/en/stu/byte-buddy-tutorial/'><meta property='og:site_name' content='Â∞èÂ∑∑ Blog'><meta property='og:type' content='article'><meta property='article:section' content='Stu'><meta property='article:tag' content='Byte Buddy'><meta property='article:tag' content='Java bytecode'><meta property='article:tag' content='dynamic proxy'><meta property='article:published_time' content='2024-07-21T17:14:51+08:00'><meta property='article:modified_time' content='2024-07-21T17:14:51+08:00'><meta name=twitter:title content="Byte Buddy Tutorial: Java Bytecode Enhancement and Dynamic Code Generation Guide"><meta name=twitter:description content=' Byte Buddy is a bytecode enhancer for Java, an elegant runtime Java code generation library that should be used with caution.\nDocumentation: http://bytebuddy.net/#/tutorial\n1. Introducing ByteBuddy\r<!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --> <dependency> <groupId>net.bytebuddy</groupId> <artifactId>byte-buddy</artifactId> <version>1.14.17</version> </dependency> 2. Learning ByteBuddy\r2.1 Class Creation\rAny instance creation starts with an instance of ByteBuddy.\nDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() .subclass(Object.class) // Enhancement method: Generate subclass of target class .name("example.Type") // Custom generated class name: package name + class name .make(); // Compile and generate the class 2.2 Specifying Package Name for Class\rDynamicType.Unloaded<?> dynamicType = byteBuddy .with(new NamingStrategy.AbstractBase() { @Override protected String name(TypeDescription superClass) { return "example." + superClass.getSimpleName(); // Customizable package name and type } }) .subclass(Object.class) .make(); 2.3 Saving Classes\rDynamicType.Unloaded<Object> dynamicType = new ByteBuddy() dynamicType.saveIn(new File("file path")); // Save the class file to folder 2.4 Injecting Classes\rDynamically generated classes can be injected into a specified jar file.\n'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/en/><img src=/img/avatar_hu_a0cc1cf57968b27d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üå±</span></figure><div class=site-meta><h1 class=site-name><a href=/en>Â∞èÂ∑∑ Blog</a></h1><h2 class=site-description>Recording is not to prove myself; rather, to make a habit of 'solving problems ‚Üí thinking ‚Üí sedimentation'.</h2></div></header><ol class=menu id=main-menu><li class=current><a href=/en/stu/><span>Study Notes</span></a></li><li><a href=/en/blog/><span>Essays</span></a></li><li><a href=/en/life/><span>Life</span></a></li><li><a href=/categories/><span>Categories</span></a></li><li><a href=/tags/><span>Tags</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://zg-dd.github.io/>ÁÆÄ‰Ωì‰∏≠Êñá</option><option value=https://zg-dd.github.io/en/ selected>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#21-class-creation>2.1 Class Creation</a></li><li><a href=#22-specifying-package-name-for-class>2.2 Specifying Package Name for Class</a></li><li><a href=#23-saving-classes>2.3 Saving Classes</a></li><li><a href=#24-injecting-classes>2.4 Injecting Classes</a></li><li><a href=#25-bytebuddy-enhancement-methods>2.5 ByteBuddy Enhancement Methods</a></li><li><a href=#26-class-loading-strategies>2.6 Class Loading Strategies</a></li><li><a href=#27-runtime-instantiation>2.7 Runtime Instantiation</a></li><li><a href=#28-field-and-method-declaration>2.8 Field and Method Declaration</a></li></ul><ul><li><a href=#210-elementmatchers-element-selectors>2.10 ElementMatchers Element Selectors</a></li><li><a href=#211-methoddelegation-method-delegation>2.11 MethodDelegation (Method Delegation)</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/en/categories/java/>Java
</a><a href=/en/categories/bytecode-manipulation/>Bytecode Manipulation</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/en/stu/byte-buddy-tutorial/>Byte Buddy Tutorial: Java Bytecode Enhancement and Dynamic Code Generation Guide</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-07-21T17:14:51+08:00>Jul 21, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>7 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://zg-dd.github.io/stu/byte-buddy-tutorial/ class=link>ÁÆÄ‰Ωì‰∏≠Êñá</a></div></footer></div></header><section class=article-content><blockquote><p>Byte Buddy is a bytecode enhancer for Java, an elegant runtime Java code generation library that should be used with caution.</p></blockquote><p>Documentation: <a class=link href=http://bytebuddy.net/#/tutorial target=_blank rel=noopener>http://bytebuddy.net/#/tutorial</a></p><h1 id=1-introducing-bytebuddy>1. Introducing ByteBuddy</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#75715e>&lt;!-- https://mvnrepository.com/artifact/net.bytebuddy/byte-buddy --&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;groupId&gt;</span>net.bytebuddy<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;artifactId&gt;</span>byte-buddy<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;version&gt;</span>1.14.17<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h1 id=2-learning-bytebuddy>2. Learning ByteBuddy</h1><h2 id=21-class-creation>2.1 Class Creation</h2><p>Any instance creation starts with an instance of ByteBuddy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)  <span style=color:#75715e>// Enhancement method: Generate subclass of target class</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;example.Type&#34;</span>)    <span style=color:#75715e>// Custom generated class name: package name + class name</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>();                 <span style=color:#75715e>// Compile and generate the class</span>
</span></span></code></pre></div><h2 id=22-specifying-package-name-for-class>2.2 Specifying Package Name for Class</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> byteBuddy
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>new</span> NamingStrategy.<span style=color:#a6e22e>AbstractBase</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>               <span style=color:#66d9ef>protected</span> String <span style=color:#a6e22e>name</span>(TypeDescription superClass) {
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;example.&#34;</span> <span style=color:#f92672>+</span> superClass.<span style=color:#a6e22e>getSimpleName</span>(); <span style=color:#75715e>// Customizable package name and type</span>
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>           }) 
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span></code></pre></div><h2 id=23-saving-classes>2.3 Saving Classes</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>dynamicType.<span style=color:#a6e22e>saveIn</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;file path&#34;</span>));  <span style=color:#75715e>// Save the class file to folder</span>
</span></span></code></pre></div><h2 id=24-injecting-classes>2.4 Injecting Classes</h2><p>Dynamically generated classes can be injected into a specified jar file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>dynamicType.<span style=color:#a6e22e>inject</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;jar&#34;</span>));  <span style=color:#75715e>// Inject the class file into the jar package</span>
</span></span></code></pre></div><h2 id=25-bytebuddy-enhancement-methods>2.5 ByteBuddy Enhancement Methods</h2><p>ByteBuddy has three enhancement methods:</p><ul><li>subclass: Generates a subclass for the target class to enhance it</li><li>rebase: When rebasing a type, Byte Buddy preserves all implementations of the rebased class. Byte Buddy copies all method implementations with compatible signatures as private renamed methods, unlike redefinition which discards overridden methods. With this approach, no method implementations are lost, and rebased methods can call these renamed methods (though this currently does not appear to work).</li><li>redefine: Redefines methods, replacing existing method implementations.</li></ul><h2 id=26-class-loading-strategies>2.6 Class Loading Strategies</h2><p>ClassLoadingStrategy.Default defines built-in strategies. If none is selected, the system will automatically deduce a strategy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>WRAPPER Strategy<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>	<span style=color:#ae81ff>1</span>. Creates a new ClassLoader to load dynamically generated types.
</span></span><span style=display:flex><span>	<span style=color:#ae81ff>2</span>. Suitable <span style=color:#66d9ef>for</span> most cases, as the dynamic classes won<span style=color:#e6db74>&#39;t be loaded by ApplicationClassLoader, which won&#39;</span>t affect classes already <span style=color:#66d9ef>in</span> the project.
</span></span><span style=display:flex><span>WRAPPER_PERSISTENT<span style=color:#960050;background-color:#1e0010>:</span> Same as WRAPPER, but exposes the byte arrays representing the classes via ClassLoader.getResourceAsStream(String). <span style=color:#66d9ef>For</span> this purpose, all <span style=color:#66d9ef>class</span> files are persisted as byte arrays <span style=color:#66d9ef>in</span> the wrapper <span style=color:#66d9ef>class</span> loader.
</span></span><span style=display:flex><span>CHILD_FIRST<span style=color:#960050;background-color:#1e0010>:</span> Creates a child-first loading ClassLoader, breaking the parent delegation model.
</span></span><span style=display:flex><span>CHILD_FIRST_PERSISTENT<span style=color:#960050;background-color:#1e0010>:</span> Same as CHILD_FIRST, but exposes the byte arrays representing the classes via ClassLoader.getResourceAsStream(String). <span style=color:#66d9ef>For</span> this purpose, all <span style=color:#66d9ef>class</span> files are persisted as byte arrays <span style=color:#66d9ef>in</span> the wrapper <span style=color:#66d9ef>class</span> loader.
</span></span><span style=display:flex><span>INJECTION Strategy<span style=color:#960050;background-color:#1e0010>:</span> Uses reflection to directly inject dynamically generated types into the current ClassLoader.
</span></span></code></pre></div><h2 id=27-runtime-instantiation>2.7 Runtime Instantiation</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)  <span style=color:#75715e>// Enhancement method: Generate subclass of target class</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;example.Type&#34;</span>)    <span style=color:#75715e>// Custom generated class name: package name + class name</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>();                 <span style=color:#75715e>// Compile and generate the class</span>
</span></span></code></pre></div><h2 id=28-field-and-method-declaration>2.8 Field and Method Declaration</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>           <span style=color:#75715e>// Enhancement method</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Object.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// Class name</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>name</span>(<span style=color:#e6db74>&#34;subclass.Example&#34;</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// Define field, type, visibility - Multiple can be used with | operator</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>defineField</span>(<span style=color:#e6db74>&#34;username&#34;</span>, String.<span style=color:#a6e22e>class</span>, Modifier.<span style=color:#a6e22e>PUBLIC</span> <span style=color:#f92672>|</span> Modifier.<span style=color:#a6e22e>STATIC</span>)
</span></span><span style=display:flex><span>           <span style=color:#75715e>// Define getter method</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>defineMethod</span>(<span style=color:#e6db74>&#34;getUserName&#34;</span>, String.<span style=color:#a6e22e>class</span>, Modifier.<span style=color:#a6e22e>PUBLIC</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>intercept</span>(FieldAccessor.<span style=color:#a6e22e>ofField</span>(<span style=color:#e6db74>&#34;username&#34;</span>)) <span style=color:#75715e>// Get value of username property</span>
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span></code></pre></div><h1 id=29-fixedvalue-for-fixed-values>2.9 FixedValue for Fixed Values</h1><p>FixedValue can declare any fixed value for field and method definitions. The fixed values will eventually be written to the <strong>constant pool of the class</strong>.</p><h2 id=210-elementmatchers-element-selectors>2.10 ElementMatchers Element Selectors</h2><p>ElementMatchers contains many matching rules for overriding original classes. Commonly used ones include:</p><ul><li>isDeclaredBy Matches all methods in a specific class</li><li>named Specifies method name</li><li>takesArguments Specifies number of arguments</li></ul><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>bar</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>(Object o) { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Building an implementation class</span>
</span></span><span style=display:flex><span>DynamicType.<span style=color:#a6e22e>Unloaded</span><span style=color:#f92672>&lt;?&gt;</span> dynamicType <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>with</span>(<span style=color:#66d9ef>new</span> NamingStrategy.<span style=color:#a6e22e>AbstractBase</span>() {
</span></span><span style=display:flex><span>               <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>               <span style=color:#66d9ef>protected</span> String <span style=color:#a6e22e>name</span>(TypeDescription superClass) {
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;subclass.subclass&#34;</span> <span style=color:#f92672>+</span> superClass.<span style=color:#a6e22e>getSimpleName</span>();
</span></span><span style=display:flex><span>               }
</span></span><span style=display:flex><span>           })
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>subclass</span>(Foo.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>isDeclaredBy</span>(Foo.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;One!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>named</span>(<span style=color:#e6db74>&#34;foo&#34;</span>)).<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;Two!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>method</span>(ElementMatchers.<span style=color:#a6e22e>named</span>(<span style=color:#e6db74>&#34;foo&#34;</span>).<span style=color:#a6e22e>and</span>(ElementMatchers.<span style=color:#a6e22e>takesArguments</span>(1)))
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>intercept</span>(FixedValue.<span style=color:#a6e22e>value</span>(<span style=color:#e6db74>&#34;Three!&#34;</span>))
</span></span><span style=display:flex><span>           .<span style=color:#a6e22e>make</span>();
</span></span><span style=display:flex><span> <span style=color:#75715e>// The final generated class looks like:</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>subclassFoo</span> <span style=color:#66d9ef>extends</span> Foo {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>(Object var1) {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Three!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>foo</span>() {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Two!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>bar</span>() {<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;One!&#34;</span>;}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>subclassFoo</span>() {}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this example:
The bar() method is matched only by ElementMatchers.isDeclaredBy(Foo.class), finally overriding to &ldquo;One!&rdquo;
The foo() method is matched by both ElementMatchers.named(&ldquo;foo&rdquo;) and ElementMatchers.named(&ldquo;foo&rdquo;).and(ElementMatchers.takesArguments(1)), resulting in &ldquo;Two!&rdquo;
foo(Object var1) is matched by ElementMatchers.named(&ldquo;foo&rdquo;).and(ElementMatchers.takesArguments(1)), overridden again to &ldquo;Three!&rdquo;</p><h2 id=211-methoddelegation-method-delegation>2.11 MethodDelegation (Method Delegation)</h2><p>Method delegation provides maximum freedom when responding to method calls. Methods in the Source can be delegated to Target method calls (the method names in Source and Target can be different); <strong>Note: All delegation methods must be declared as static</strong></p><p>Simple example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Rebase target</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>hello</span>(String name) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.hello origin&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load origin: &#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Delegate class</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>hello</span>(String name) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.hello &#34;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Parameter enhancement</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> Arrays.<span style=color:#a6e22e>asList</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: foo&#34;</span>, info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: bar&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> list;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.load finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Test method</span>
</span></span><span style=display:flex><span> MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemoryDatabase();
</span></span><span style=display:flex><span> loggingDatabase.<span style=color:#a6e22e>hello</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>);
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return value: &#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span><span style=display:flex><span> <span style=color:#75715e>// Delegate specified methods of MemoryDatabase class</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>redefine</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>method</span>(named(<span style=color:#e6db74>&#34;hello&#34;</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>method</span>(named(<span style=color:#e6db74>&#34;load&#34;</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>(), ClassReloadingStrategy.<span style=color:#a6e22e>fromInstalledAgent</span>())  <span style=color:#75715e>// ClassReloadingStrategy.fromInstalledAgent() indicates using agent to modify source method</span>
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>getLoaded</span>();
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;After rebasing...&#34;</span>);
</span></span><span style=display:flex><span> loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemoryDatabase();
</span></span><span style=display:flex><span> loggingDatabase.<span style=color:#a6e22e>hello</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>);
</span></span><span style=display:flex><span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return value: &#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#75715e>// Execution results:</span>
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>hello</span> origin
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> origin: hello MemoryDatabase
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>return</span> value: <span style=color:#f92672>[</span>hello MemoryDatabase, hello MemoryDatabase<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>After rebasing...
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>hello</span> hello MemoryDatabase<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span> before
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span> after
</span></span><span style=display:flex><span>LoggerInterceptor.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>MemoryDatabase.<span style=color:#a6e22e>load</span> <span style=color:#66d9ef>return</span> value: <span style=color:#f92672>[</span>hello MemoryDatabase: foo, hello MemoryDatabase: bar<span style=color:#f92672>]</span>
</span></span></code></pre></div><blockquote><p>This simple example shows that method delegation can completely replace the original methods, performing rebasing modifications. It plays an important role in modifying source code. Note: subclass enhances the parent class without affecting the source class, while redefine and rebase require agent permissions and need to add VM parameter before starting the class loader: -javaagent:path\byte-buddy-agent-1.14.17.jar. byte-buddy-agent refers to the code jar file, which can be downloaded online. Let&rsquo;s begin learning various scenarios of method delegation:</p></blockquote><ul><li><p>@SuperCall</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load origin: &#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>@SuperCall</span> Callable<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> zuper) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Parameter enhancement</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> call <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>call</span>();
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> call;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Test:</span>
</span></span><span style=display:flex><span>MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>method</span>(isDeclaredBy(MemoryDatabase.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>getLoaded</span>().<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return value: &#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span></code></pre></div><p>In the above example, MemoryDatabase.load is delegated to LoggerInterceptor.log; @SuperCall indicates this is a proxy method, referring to MemoryDatabase.load. Callable&lt;List> represents the return type of the load method. This approach is essentially how Spring AOP works.</p></li><li><p>@Super</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load origin: &#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// info represents method parameter, zuper annotated with @Super indicates proxy object</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(String info, <span style=color:#a6e22e>@Super</span> MemoryDatabase zuper) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log before&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Parameter enhancement</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> strings <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>load</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Interceptor&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log after&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> strings;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(e);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log finally&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// Test:</span>
</span></span><span style=display:flex><span>MemoryDatabase loggingDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteBuddy()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subclass</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>method</span>(isDeclaredBy(MemoryDatabase.<span style=color:#a6e22e>class</span>)).<span style=color:#a6e22e>intercept</span>(MethodDelegation.<span style=color:#a6e22e>to</span>(LoggerInterceptor.<span style=color:#a6e22e>class</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>make</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>load</span>(MemoryDatabase.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getClassLoader</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>getLoaded</span>().<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load return value: &#34;</span> <span style=color:#f92672>+</span> loggingDatabase.<span style=color:#a6e22e>load</span>(<span style=color:#e6db74>&#34;hello MemoryDatabase&#34;</span>));
</span></span></code></pre></div><p>@Super specifically indicates the proxy instance for precise implementation.</p></li><li><p>@RuntimeType</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemoryDatabase</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(String info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load origin: &#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>load</span>(Integer info) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;MemoryDatabase.load origin: &#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Arrays.<span style=color:#a6e22e>asList</span>(info, info);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggerInterceptor</span> {
</span></span><span style=display:flex><span><span style=color:#75715e>// @RuntimeType specifies concrete parameter types at runtime</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>@RuntimeType</span> Object info, <span style=color:#a6e22e>@Super</span> MemoryDatabase zuper) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Parameter enhancement</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> strings <span style=color:#f92672>=</span> zuper.<span style=color:#a6e22e>load</span>(info <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Interceptor&#34;</span>);
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;LoggerInterceptor.log :&#34;</span> <span style=color:#f92672>+</span> info);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> strings;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>@RuntimeType specifies parameters at runtime, enabling method overloading effects.</p><ul><li>@Pipe</li></ul><blockquote><p>Continuously learning and updating&mldr;</p></blockquote><p>Reference article: <a class=link href=https://blog.csdn.net/zhou920786312/article/details/130649115 target=_blank rel=noopener>https://blog.csdn.net/zhou920786312/article/details/130649115</a></p></section><footer class=article-footer><section class=article-tags><a href=/en/tags/byte-buddy/>Byte Buddy</a>
<a href=/en/tags/java-bytecode/>Java Bytecode</a>
<a href=/en/tags/dynamic-proxy/>Dynamic Proxy</a></section></footer></article><script src=https://giscus.app/client.js data-repo=zg-dd/zg-dd.github.io data-repo-id=R_kgDOQwB7tw data-category=Announcements data-category-id=DIC_kwDOQwB7t84C0WGD data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"preferred_color_scheme")}})()</script><footer class=site-footer><section class=copyright>&copy;
2026 Â∞èÂ∑∑ Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>